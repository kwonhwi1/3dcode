MODULE BC_MODULE
  USE CONFIG_MODULE
  USE GRID_MODULE
  USE VARIABLE_MODULE
  USE EOS_MODULE
  USE PROP_MODULE
  IMPLICIT NONE
  PRIVATE
  PUBLIC :: T_BC
  
  TYPE, EXTENDS(T_BCINFO) :: T_BCINFO_P
    PROCEDURE(P_BCTYPE), POINTER :: BCTYPE
    CHARACTER(4) :: FACE
  END TYPE T_BCINFO_P
  
  TYPE T_REF
    REAL(8), DIMENSION(:), ALLOCATABLE :: PV,TV,DV
  END TYPE T_REF
  
  TYPE T_BC
    PRIVATE
    INTEGER :: RANK,SIZE,NBC,NCON
    INTEGER :: NPV,NTV,NDV,NGRD
    TYPE(T_REF) :: REF
    TYPE(T_BCINFO_P), DIMENSION(:), ALLOCATABLE :: BCINFO
    TYPE(T_CONNECTINFO), DIMENSION(:), ALLOCATABLE ::CONNECTINFO
    CONTAINS
      PROCEDURE :: CONSTRUCT
      PROCEDURE :: DESTRUCT
      PROCEDURE :: SETBC
      PROCEDURE, PRIVATE :: BCCORNER
  END TYPE T_BC

  INTERFACE
    SUBROUTINE P_BCTYPE(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPORT T_BCINFO_P
      IMPORT T_REF
      IMPORT T_GRID
      IMPORT T_VARIABLE
      IMPORT T_EOS
      IMPORT T_PROP  
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
    END SUBROUTINE P_BCTYPE
  END INTERFACE
  CONTAINS
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE CONSTRUCT(BC,CONFIG,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BC), INTENT(OUT) :: BC
      TYPE(T_CONFIG), INTENT(IN) :: CONFIG
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(IN) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: L,N,M
      INTEGER, PARAMETER :: DIM = 3
      
      BC%RANK = CONFIG%GETRANK() 
      BC%SIZE = CONFIG%GETSIZE()

      BC%NBC = GRID%GETNBC()
      BC%NCON = GRID%GETNCON()
      BC%NPV = VARIABLE%GETNPV()
      BC%NTV = VARIABLE%GETNTV()
      BC%NDV = VARIABLE%GETNDV()
      BC%NGRD = GRID%GETNGRD()

      ALLOCATE(BC%REF%PV(BC%NPV),BC%REF%DV(BC%NDV),BC%REF%TV(BC%NTV))
      
      BC%REF%PV(1) = CONFIG%GETPREF()
      BC%REF%PV(2) = CONFIG%GETUREF()*DCOS(CONFIG%GETAOA())
      BC%REF%PV(3) = CONFIG%GETUREF()*DSIN(CONFIG%GETAOA())
      BC%REF%PV(4) = 0.D0
      BC%REF%PV(5) = CONFIG%GETTREF()
      BC%REF%PV(6) = CONFIG%GETY1REF()
      BC%REF%PV(7) = CONFIG%GETY2REF()
      
      CALL EOS%DETEOS(BC%REF%PV(1),BC%REF%PV(5),BC%REF%PV(6),BC%REF%PV(7),BC%REF%DV)
      
      IF(CONFIG%GETITURB().GE.-2) THEN
        CALL PROP%DETPROP(BC%REF%DV(3),BC%REF%DV(4),BC%REF%DV(5),BC%REF%PV(5),BC%REF%PV(6),BC%REF%PV(7),BC%REF%TV(1:2))
        IF(CONFIG%GETITURB().GE.-1) THEN
          BC%REF%TV(3) = CONFIG%GETEMUTREF()
          BC%REF%PV(8) = CONFIG%GETKREF()
          BC%REF%PV(9) = CONFIG%GETOREF()
        END IF
      END IF
 
      ALLOCATE(BC%BCINFO(BC%NBC),BC%CONNECTINFO(BC%NCON))
      
      DO N=1,BC%NBC
        BC%BCINFO(N)%BCNAME = GRID%GETBCNAME(N)
        DO M=1,DIM
          BC%BCINFO(N)%ISTART(M) = GRID%GETBCISTART(N,M)
          BC%BCINFO(N)%IEND(M)   = GRID%GETBCIEND(N,M)
        END DO
        
        IF(BC%BCINFO(N)%ISTART(2).EQ.BC%BCINFO(N)%IEND(2)) THEN
          IF(BC%BCINFO(N)%ISTART(2).EQ.1) THEN
            BC%BCINFO(N)%FACE = 'JMIN'
            BC%BCINFO(N)%ISTART(2) = BC%BCINFO(N)%ISTART(2)-2
          ELSE
            BC%BCINFO(N)%FACE = 'JMAX'
            BC%BCINFO(N)%IEND(2) = BC%BCINFO(N)%IEND(2)+2
          END IF
        ELSE IF(BC%BCINFO(N)%ISTART(1).EQ.BC%BCINFO(N)%IEND(1)) THEN
          IF(BC%BCINFO(N)%ISTART(1).EQ.1) THEN
            BC%BCINFO(N)%FACE = 'IMIN'
            BC%BCINFO(N)%ISTART(1) = BC%BCINFO(N)%ISTART(1)-2
          ELSE
            BC%BCINFO(N)%FACE = 'IMAX'
            BC%BCINFO(N)%IEND(1) = BC%BCINFO(N)%IEND(1)+2
          END IF
        ELSE IF(BC%BCINFO(N)%ISTART(3).EQ.BC%BCINFO(N)%IEND(3)) THEN
          IF(BC%BCINFO(N)%ISTART(3).EQ.1) THEN
            BC%BCINFO(N)%FACE = 'KMIN'
            BC%BCINFO(N)%ISTART(3) = BC%BCINFO(N)%ISTART(3)-2
          ELSE
            BC%BCINFO(N)%FACE = 'KMAX'
            BC%BCINFO(N)%IEND(3) = BC%BCINFO(N)%IEND(3)+2
          END IF 
        END IF
        
        IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCWallInviscid') THEN
          BC%BCINFO(N)%BCTYPE => BCWALLINVISCID
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCWallViscous') THEN
          SELECT CASE(CONFIG%GETITURB())
          CASE(-1)
            BC%BCINFO(N)%BCTYPE => BCWALLVISCOUSKE
          CASE(0)
            BC%BCINFO(N)%BCTYPE => BCWALLVISCOUSKW
          CASE DEFAULT
            BC%BCINFO(N)%BCTYPE => BCWALLVISCOUS
          END SELECT
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCInflow') THEN
          BC%BCINFO(N)%BCTYPE => BCINFLOW
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCInflowSubsonic') THEN
          BC%BCINFO(N)%BCTYPE => BCINFLOWSUBSONIC
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCInflowSupersonic') THEN
          BC%BCINFO(N)%BCTYPE => BCINFLOWSUPERSONIC
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCOutflow') THEN
          BC%BCINFO(N)%BCTYPE => BCOUTFLOW
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCOutflowSubsonic') THEN
          BC%BCINFO(N)%BCTYPE => BCOUTFLOWSUBSONIC
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCOutflowSupersonic') THEN
          BC%BCINFO(N)%BCTYPE => BCOUTFLOWSUPERSONIC
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCFarfield') THEN
          BC%BCINFO(N)%BCTYPE => BCFARFIELD
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCDegeneratePoint') THEN
          BC%BCINFO(N)%BCTYPE => BCDEGENERATEPOINT
        ELSE IF(TRIM(BC%BCINFO(N)%BCNAME).EQ.'BCSymmetryPlane') THEN
          BC%BCINFO(N)%BCTYPE => BCDEGENERATEPOINT
        ELSE
          BC%BCINFO(N)%BCTYPE => NULL()
          WRITE(*,*) 'ERROR, CHECK BC NAME'
          STOP
        END IF
      END DO

      DO N=1,BC%NCON
        BC%CONNECTINFO(N)%DONOR = GRID%GETCONNECTDONOR(N)
        
        DO M=1,DIM
          BC%CONNECTINFO(N)%ISTART(M) = GRID%GETCONNECTISTART(N,M)
          BC%CONNECTINFO(N)%IEND(M)   = GRID%GETCONNECTIEND(N,M)
          BC%CONNECTINFO(N)%ISTART_DONOR(M) = GRID%GETCONNECTISTART_DONOR(N,M)
          BC%CONNECTINFO(N)%IEND_DONOR(M)   = GRID%GETCONNECTIEND_DONOR(N,M)
          DO L=1,DIM
            BC%CONNECTINFO(N)%TRANSMAT(M,L) = GRID%GETCONNECTTRANSMAT(N,M,L)
          END DO
        END DO

        IF(BC%CONNECTINFO(N)%ISTART(2).EQ.BC%CONNECTINFO(N)%IEND(2)) THEN
          IF(BC%CONNECTINFO(N)%ISTART(2).EQ.2) THEN
            BC%CONNECTINFO(N)%IEND(2) = BC%CONNECTINFO(N)%IEND(2) + 2
            IF(BC%CONNECTINFO(N)%TRANSMAT(1,2).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(1) = BC%CONNECTINFO(N)%IEND_DONOR(1) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(1,2).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(1) = BC%CONNECTINFO(N)%IEND_DONOR(1) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,2).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(2) = BC%CONNECTINFO(N)%IEND_DONOR(2) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,2).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(2) = BC%CONNECTINFO(N)%IEND_DONOR(2) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,2).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(3) = BC%CONNECTINFO(N)%IEND_DONOR(3) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,2).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(3) = BC%CONNECTINFO(N)%IEND_DONOR(3) - 2
            END IF
          ELSE
            BC%CONNECTINFO(N)%ISTART(2) = BC%CONNECTINFO(N)%ISTART(2) - 2
            IF(BC%CONNECTINFO(N)%TRANSMAT(1,2).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(1) = BC%CONNECTINFO(N)%ISTART_DONOR(1) - 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(1,2).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(1) = BC%CONNECTINFO(N)%ISTART_DONOR(1) + 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,2).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(2) = BC%CONNECTINFO(N)%ISTART_DONOR(2) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,2).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(2) = BC%CONNECTINFO(N)%ISTART_DONOR(2) + 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,2).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(3) = BC%CONNECTINFO(N)%ISTART_DONOR(3) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,2).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(3) = BC%CONNECTINFO(N)%ISTART_DONOR(3) + 2
            END IF
          END IF
        ELSE IF(BC%CONNECTINFO(N)%ISTART(1).EQ.BC%CONNECTINFO(N)%IEND(1)) THEN
          IF(BC%CONNECTINFO(N)%ISTART(1).EQ.2) THEN
            BC%CONNECTINFO(N)%IEND(1) = BC%CONNECTINFO(N)%IEND(1) + 2
            IF(BC%CONNECTINFO(N)%TRANSMAT(1,1).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(1) = BC%CONNECTINFO(N)%IEND_DONOR(1) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(1,1).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(1) = BC%CONNECTINFO(N)%IEND_DONOR(1) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,1).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(2) = BC%CONNECTINFO(N)%IEND_DONOR(2) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,1).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(2) = BC%CONNECTINFO(N)%IEND_DONOR(2) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,1).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(3) = BC%CONNECTINFO(N)%IEND_DONOR(3) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,1).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(3) = BC%CONNECTINFO(N)%IEND_DONOR(3) - 2
            END IF
          ELSE
            BC%CONNECTINFO(N)%ISTART(1) = BC%CONNECTINFO(N)%ISTART(1) - 2
            IF(BC%CONNECTINFO(N)%TRANSMAT(1,1).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(1) = BC%CONNECTINFO(N)%ISTART_DONOR(1) - 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(1,1).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(1) = BC%CONNECTINFO(N)%ISTART_DONOR(1) + 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,1).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(2) = BC%CONNECTINFO(N)%ISTART_DONOR(2) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,1).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(2) = BC%CONNECTINFO(N)%ISTART_DONOR(2) + 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,1).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(3) = BC%CONNECTINFO(N)%ISTART_DONOR(3) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,1).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(3) = BC%CONNECTINFO(N)%ISTART_DONOR(3) + 2
            END IF
          END IF
        ELSE IF(BC%CONNECTINFO(N)%ISTART(3).EQ.BC%CONNECTINFO(N)%IEND(3)) THEN
          IF(BC%CONNECTINFO(N)%ISTART(3).EQ.2) THEN
            BC%CONNECTINFO(N)%IEND(3) = BC%CONNECTINFO(N)%IEND(3) + 2
            IF(BC%CONNECTINFO(N)%TRANSMAT(1,3).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(1) = BC%CONNECTINFO(N)%IEND_DONOR(1) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(1,3).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(1) = BC%CONNECTINFO(N)%IEND_DONOR(1) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,3).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(2) = BC%CONNECTINFO(N)%IEND_DONOR(2) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,3).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(2) = BC%CONNECTINFO(N)%IEND_DONOR(2) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,3).EQ.1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(3) = BC%CONNECTINFO(N)%IEND_DONOR(3) + 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,3).EQ.-1) THEN
              BC%CONNECTINFO(N)%IEND_DONOR(3) = BC%CONNECTINFO(N)%IEND_DONOR(3) - 2
            END IF
          ELSE
            BC%CONNECTINFO(N)%ISTART(3) = BC%CONNECTINFO(N)%ISTART(3) - 2
            IF(BC%CONNECTINFO(N)%TRANSMAT(1,3).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(1) = BC%CONNECTINFO(N)%ISTART_DONOR(1) - 2 
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(1,3).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(1) = BC%CONNECTINFO(N)%ISTART_DONOR(1) + 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,3).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(2) = BC%CONNECTINFO(N)%ISTART_DONOR(2) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(2,3).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(2) = BC%CONNECTINFO(N)%ISTART_DONOR(2) + 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,3).EQ.1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(3) = BC%CONNECTINFO(N)%ISTART_DONOR(3) - 2
            ELSE IF(BC%CONNECTINFO(N)%TRANSMAT(3,3).EQ.-1) THEN
              BC%CONNECTINFO(N)%ISTART_DONOR(3) = BC%CONNECTINFO(N)%ISTART_DONOR(3) + 2
            END IF
          END IF
        END IF
      END DO

    END SUBROUTINE CONSTRUCT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE DESTRUCT(BC)
      IMPLICIT NONE
      CLASS(T_BC), INTENT(INOUT) :: BC
      INTEGER :: N
      
      DO N=1,BC%NBC
        IF(ASSOCIATED(BC%BCINFO(N)%BCTYPE)) NULLIFY(BC%BCINFO(N)%BCTYPE)
      END DO
      
      DEALLOCATE(BC%REF%PV,BC%REF%DV,BC%REF%TV)
      DEALLOCATE(BC%BCINFO,BC%CONNECTINFO)
    END SUBROUTINE DESTRUCT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE SETBC(BC,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      INCLUDE 'mpif.h'
      CLASS(T_BC), INTENT(INOUT) :: BC
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,N,M,L
      INTEGER :: II,JJ,KK,NUM
      INTEGER :: IER,REQUEST1,REQUEST2,REQUEST3,REQUEST4
      INTEGER :: STATUS(MPI_STATUS_SIZE)
      INTEGER :: SENDADRESS(21),RECVADRESS(21)
      REAL(8) :: PV(BC%NPV),DV(BC%NDV),TV(BC%NTV)
      REAL(8), DIMENSION(:), ALLOCATABLE :: SENDBUF,RECVBUF
      
      DO N=1,BC%NBC
        CALL BC%BCINFO(N)%BCTYPE(BC%REF,GRID,VARIABLE,EOS,PROP)
      END DO
      
      DO N=1,BC%NCON
        NUM = (ABS(BC%CONNECTINFO(N)%ISTART(2)-BC%CONNECTINFO(N)%IEND(2))+1) &
             *(ABS(BC%CONNECTINFO(N)%ISTART(1)-BC%CONNECTINFO(N)%IEND(1))+1) &
             *(ABS(BC%CONNECTINFO(N)%ISTART(3)-BC%CONNECTINFO(N)%IEND(3))+1)*(BC%NPV+BC%NTV+BC%NDV)
        ALLOCATE(SENDBUF(NUM))
        L = 0
        DO K=BC%CONNECTINFO(N)%ISTART(3),BC%CONNECTINFO(N)%IEND(3)
          DO J=BC%CONNECTINFO(N)%ISTART(2),BC%CONNECTINFO(N)%IEND(2)
            DO I=BC%CONNECTINFO(N)%ISTART(1),BC%CONNECTINFO(N)%IEND(1)
              PV = VARIABLE%GETPV(I,J,K)
              TV = VARIABLE%GETTV(I,J,K)
              DV = VARIABLE%GETDV(I,J,K)
              DO M=1,BC%NPV
                L = L + 1
                SENDBUF(L) = PV(M)
              END DO
              DO M=1,BC%NTV
                L = L + 1
                SENDBUF(L) = TV(M)
              END DO
              DO M=1,BC%NDV
                L = L + 1
                SENDBUF(L) = DV(M)
              END DO            
            END DO
          END DO
        END DO
          
        IF(BC%RANK.NE.BC%CONNECTINFO(N)%DONOR) THEN 
          SENDADRESS = (/BC%CONNECTINFO(N)%ISTART(1),BC%CONNECTINFO(N)%IEND(1), &
                         BC%CONNECTINFO(N)%ISTART(2),BC%CONNECTINFO(N)%IEND(2), &
                         BC%CONNECTINFO(N)%ISTART(3),BC%CONNECTINFO(N)%IEND(3), &
                         BC%CONNECTINFO(N)%ISTART_DONOR(1),BC%CONNECTINFO(N)%IEND_DONOR(1), &
                         BC%CONNECTINFO(N)%ISTART_DONOR(2),BC%CONNECTINFO(N)%IEND_DONOR(2), &
                         BC%CONNECTINFO(N)%ISTART_DONOR(3),BC%CONNECTINFO(N)%IEND_DONOR(3), &  
                         BC%CONNECTINFO(N)%TRANSMAT(1,1),BC%CONNECTINFO(N)%TRANSMAT(1,2),BC%CONNECTINFO(N)%TRANSMAT(1,3), &
                         BC%CONNECTINFO(N)%TRANSMAT(2,1),BC%CONNECTINFO(N)%TRANSMAT(2,2),BC%CONNECTINFO(N)%TRANSMAT(2,3), &
                         BC%CONNECTINFO(N)%TRANSMAT(3,1),BC%CONNECTINFO(N)%TRANSMAT(3,2),BC%CONNECTINFO(N)%TRANSMAT(3,3)/)
                     

          CALL MPI_ISEND(SENDADRESS,21,MPI_INTEGER,BC%CONNECTINFO(N)%DONOR,BC%RANK+10000,MPI_COMM_WORLD,REQUEST1,IER)
          CALL MPI_ISEND(SENDBUF,NUM,MPI_REAL8,BC%CONNECTINFO(N)%DONOR,BC%RANK,MPI_COMM_WORLD,REQUEST2,IER)
          CALL MPI_WAIT(REQUEST1,STATUS,IER)
          CALL MPI_WAIT(REQUEST2,STATUS,IER)
        ELSE  
          L = 0
          DO K=BC%CONNECTINFO(N)%ISTART(3),BC%CONNECTINFO(N)%IEND(3)
            DO J=BC%CONNECTINFO(N)%ISTART(2),BC%CONNECTINFO(N)%IEND(2)
              DO I=BC%CONNECTINFO(N)%ISTART(1),BC%CONNECTINFO(N)%IEND(1)
                II = BC%CONNECTINFO(N)%TRANSMAT(1,1)*(I-BC%CONNECTINFO(N)%ISTART(1)) &
                   + BC%CONNECTINFO(N)%TRANSMAT(1,2)*(J-BC%CONNECTINFO(N)%ISTART(2)) &
                   + BC%CONNECTINFO(N)%TRANSMAT(1,3)*(K-BC%CONNECTINFO(N)%ISTART(3)) + BC%CONNECTINFO(N)%ISTART_DONOR(1)
                JJ = BC%CONNECTINFO(N)%TRANSMAT(2,1)*(I-BC%CONNECTINFO(N)%ISTART(1)) &
                   + BC%CONNECTINFO(N)%TRANSMAT(2,2)*(J-BC%CONNECTINFO(N)%ISTART(2)) &
                   + BC%CONNECTINFO(N)%TRANSMAT(2,3)*(K-BC%CONNECTINFO(N)%ISTART(3)) + BC%CONNECTINFO(N)%ISTART_DONOR(2)
                KK = BC%CONNECTINFO(N)%TRANSMAT(3,1)*(I-BC%CONNECTINFO(N)%ISTART(1)) &
                   + BC%CONNECTINFO(N)%TRANSMAT(3,2)*(J-BC%CONNECTINFO(N)%ISTART(2)) &
                   + BC%CONNECTINFO(N)%TRANSMAT(3,3)*(K-BC%CONNECTINFO(N)%ISTART(3)) + BC%CONNECTINFO(N)%ISTART_DONOR(3)
                DO M=1,BC%NPV
                  L = L + 1
                  CALL VARIABLE%SETPV(M,II,JJ,KK,SENDBUF(L))
                END DO
                DO M=1,BC%NTV
                  L = L + 1
                  CALL VARIABLE%SETTV(M,II,JJ,KK,SENDBUF(L))
                END DO
                DO M=1,BC%NDV
                  L = L + 1
                  CALL VARIABLE%SETDV(M,II,JJ,KK,SENDBUF(L))
                END DO
              END DO
            END DO
          END DO
        END IF
        DEALLOCATE(SENDBUF)
      END DO

      DO N=1,BC%NCON
        NUM = (ABS(BC%CONNECTINFO(N)%ISTART(2)-BC%CONNECTINFO(N)%IEND(2))+1) &
             *(ABS(BC%CONNECTINFO(N)%ISTART(1)-BC%CONNECTINFO(N)%IEND(1))+1) &
             *(ABS(BC%CONNECTINFO(N)%ISTART(3)-BC%CONNECTINFO(N)%IEND(3))+1)*(BC%NPV+BC%NTV+BC%NDV)
        ALLOCATE(RECVBUF(NUM))
        IF(BC%RANK.NE.BC%CONNECTINFO(N)%DONOR) THEN 
          CALL MPI_IRECV(RECVADRESS,21,MPI_INTEGER,BC%CONNECTINFO(N)%DONOR,BC%CONNECTINFO(N)%DONOR+10000,MPI_COMM_WORLD,REQUEST3,IER)
          CALL MPI_IRECV(RECVBUF,NUM,MPI_REAL8,BC%CONNECTINFO(N)%DONOR,BC%CONNECTINFO(N)%DONOR,MPI_COMM_WORLD,REQUEST4,IER)
          CALL MPI_WAIT(REQUEST3,STATUS,IER)
          CALL MPI_WAIT(REQUEST4,STATUS,IER)
      
          L = 0
          DO K=RECVADRESS(5),RECVADRESS(6)
            DO J=RECVADRESS(3),RECVADRESS(4)
              DO I=RECVADRESS(1),RECVADRESS(2)
                II = RECVADRESS(13)*(I-RECVADRESS(1)) + RECVADRESS(14)*(J-RECVADRESS(3)) + RECVADRESS(15)*(k-RECVADRESS(5)) + RECVADRESS(7)
                JJ = RECVADRESS(16)*(I-RECVADRESS(1)) + RECVADRESS(17)*(J-RECVADRESS(3)) + RECVADRESS(18)*(K-RECVADRESS(5)) + RECVADRESS(9)
                KK = RECVADRESS(19)*(I-RECVADRESS(1)) + RECVADRESS(20)*(J-RECVADRESS(3)) + RECVADRESS(21)*(K-RECVADRESS(5)) + RECVADRESS(11)
                DO M=1,BC%NPV
                  L = L + 1
                  CALL VARIABLE%SETPV(M,II,JJ,KK,RECVBUF(L))
                END DO
                DO M=1,BC%NTV
                  L = L + 1
                  CALL VARIABLE%SETTV(M,II,JJ,KK,RECVBUF(L))
                END DO
                DO M=1,BC%NDV
                  L = L + 1
                  CALL VARIABLE%SETDV(M,II,JJ,KK,RECVBUF(L))
                END DO
              END DO
            END DO
          END DO
        END IF
        DEALLOCATE(RECVBUF)
      END DO
      
      DO I=2,GRID%GETIMAX()
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,2,2,0,-1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,1,2,0,-1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,2,1,0,-1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,1,1,0,-1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()  ,2,0,1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()+1,2,0,1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()  ,1,0,1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()+1,1,0,1,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,2,GRID%GETKMAX()  ,0,-1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,1,GRID%GETKMAX()  ,0,-1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,2,GRID%GETKMAX()+1,0,-1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,1,GRID%GETKMAX()+1,0,-1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()  ,GRID%GETKMAX()  ,0,1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()+1,GRID%GETKMAX()  ,0,1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()  ,GRID%GETKMAX()+1,0,1,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,I,GRID%GETJMAX()+1,GRID%GETKMAX()+1,0,1,1)
      END DO
      DO J=2,GRID%GETJMAX()
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,J,2,-1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,J,2,-1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,J,1,-1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,J,1,-1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,J,2,1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,J,2,1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,J,1,1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,J,1,1,0,-1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,J,GRID%GETKMAX()  ,-1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,J,GRID%GETKMAX()  ,-1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,J,GRID%GETKMAX()+1,-1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,J,GRID%GETKMAX()+1,-1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,J,GRID%GETKMAX()  ,1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,J,GRID%GETKMAX()  ,1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,J,GRID%GETKMAX()+1,1,0,1)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,J,GRID%GETKMAX()+1,1,0,1)
      END DO
      DO K=2,GRID%GETKMAX()
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,2,K,-1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,2,K,-1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,1,K,-1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,1,K,-1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,2,K,1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,2,K,1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,1,K,1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,1,K,1,-1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()  ,K,-1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()  ,K,-1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()+1,K,-1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()+1,K,-1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()  ,K,1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()  ,K,1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()+1,K,1,1,0)
        CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()+1,K,1,1,0)
      END DO
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,2,2,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,2,2,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,1,2,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,2,1,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,1,2,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,1,1,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,2,1,-1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,1,1,-1,-1,-1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,2,2,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,2,2,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,1,2,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,2,1,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,1,2,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,1,1,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,2,1,1,-1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,1,1,1,-1,-1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()  ,2,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()  ,2,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()+1,2,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()  ,1,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()+1,2,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()+1,1,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()  ,1,-1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()+1,1,-1,1,-1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,2,GRID%GETKMAX()  ,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,2,GRID%GETKMAX()  ,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,1,GRID%GETKMAX()  ,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,2,GRID%GETKMAX()+1,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,1,GRID%GETKMAX()  ,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,1,GRID%GETKMAX()+1,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,2,GRID%GETKMAX()+1,-1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,1,GRID%GETKMAX()+1,-1,-1,1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()  ,2,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()  ,2,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()+1,2,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()  ,1,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()+1,2,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()+1,1,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()  ,1,1,1,-1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()+1,1,1,1,-1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()  ,GRID%GETKMAX()  ,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()  ,GRID%GETKMAX()  ,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()+1,GRID%GETKMAX()  ,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()  ,GRID%GETKMAX()+1,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()+1,GRID%GETKMAX()  ,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,2,GRID%GETJMAX()+1,GRID%GETKMAX()+1,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()  ,GRID%GETKMAX()+1,-1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,1,GRID%GETJMAX()+1,GRID%GETKMAX()+1,-1,1,1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,2,GRID%GETKMAX()  ,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,2,GRID%GETKMAX()  ,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,1,GRID%GETKMAX()  ,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,2,GRID%GETKMAX()+1,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,1,GRID%GETKMAX()  ,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,1,GRID%GETKMAX()+1,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,2,GRID%GETKMAX()+1,1,-1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,1,GRID%GETKMAX()+1,1,-1,1)
      
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()  ,GRID%GETKMAX()  ,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()  ,GRID%GETKMAX()  ,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()+1,GRID%GETKMAX()  ,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()  ,GRID%GETKMAX()+1,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()+1,GRID%GETKMAX()  ,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()  ,GRID%GETJMAX()+1,GRID%GETKMAX()+1,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()  ,GRID%GETKMAX()+1,1,1,1)
      CALL BC%BCCORNER(GRID,VARIABLE,EOS,PROP,GRID%GETIMAX()+1,GRID%GETJMAX()+1,GRID%GETKMAX()+1,1,1,1)
      
    END SUBROUTINE SETBC
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCCORNER(BC,GRID,VARIABLE,EOS,PROP,I,J,K,II,JJ,KK)
      IMPLICIT NONE
      CLASS(T_BC), INTENT(IN) :: BC
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER, INTENT(IN) :: I,J,K,II,JJ,KK
      INTEGER :: N
      REAL(8) :: DQDX(BC%NPV),DQDY(BC%NPV),DQDZ(BC%NPV),PV(BC%NPV)
      REAL(8) :: DV(BC%NDV),TV(BC%NTV)
      REAL(8), PARAMETER :: C13 = 1.D0/3.D0
      
      DQDX = C13*(VARIABLE%GETPV(I+II,J,K)-VARIABLE%GETPV(I,J,K))
      DQDY = C13*(VARIABLE%GETPV(I,J+JJ,K)-VARIABLE%GETPV(I,J,K))
      DQDZ = C13*(VARIABLE%GETPV(I,J,K+KK)-VARIABLE%GETPV(I,J,K))
    
      
      DO N=1,BC%NPV
        CALL VARIABLE%SETPV(N,I+II,J+JJ,K+KK,PV(N))
      END DO
      
      CALL EOS%DETEOS(PV(1)+BC%REF%PV(1),PV(5),PV(6),PV(7),DV)
      
      DO N=1,BC%NDV
        CALL VARIABLE%SETDV(N,I+II,J+JJ,K+KK,DV(N))
      END DO
      
      IF(BC%NTV.NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
      
      DO N=1,BC%NTV
        CALL VARIABLE%SETTV(N,I+II,J+JJ,K+KK,TV(N))
      END DO
      

    END SUBROUTINE BCCORNER
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCWALLINVISCID(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M,II,JJ,KK
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      REAL(8) :: NX(3),VAR
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETCX(BCINFO%IEND(1),J,K)
              II = BCINFO%IEND(1)-I + BCINFO%IEND(1)+1
              PV = VARIABLE%GETPV(II,J,K)
              DV = VARIABLE%GETDV(II,J,K)
              TV = VARIABLE%GETTV(II,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETCX(BCINFO%ISTART(1)-1,J,K)
              II = BCINFO%ISTART(1)-I + BCINFO%ISTART(1)-1
              PV = VARIABLE%GETPV(II,J,K)
              DV = VARIABLE%GETDV(II,J,K)
              TV = VARIABLE%GETTV(II,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETEX(I,BCINFO%IEND(2),K)
              JJ = BCINFO%IEND(2)-J + BCINFO%IEND(2)+1
              PV = VARIABLE%GETPV(I,JJ,K)
              DV = VARIABLE%GETDV(I,JJ,K)
              TV = VARIABLE%GETTV(I,JJ,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETEX(I,BCINFO%ISTART(2)-1,K)
              JJ = BCINFO%ISTART(2)-J + BCINFO%ISTART(2)-1
              PV = VARIABLE%GETPV(I,JJ,K)
              DV = VARIABLE%GETDV(I,JJ,K)
              TV = VARIABLE%GETTV(I,JJ,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETTX(I,J,BCINFO%IEND(3))
              KK = BCINFO%IEND(3)-K + BCINFO%IEND(3)+1
              PV = VARIABLE%GETPV(I,J,KK)
              DV = VARIABLE%GETDV(I,J,KK)
              TV = VARIABLE%GETTV(I,J,KK)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETTX(I,J,BCINFO%ISTART(3)-1)
              KK = BCINFO%ISTART(3)-K + BCINFO%ISTART(3)-1
              PV = VARIABLE%GETPV(I,J,KK)
              DV = VARIABLE%GETDV(I,J,KK)
              TV = VARIABLE%GETTV(I,J,KK)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
    
    END SUBROUTINE BCWALLINVISCID
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCWALLVISCOUS(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              DV = VARIABLE%GETDV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              DV = VARIABLE%GETDV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              DV = VARIABLE%GETDV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              DV = VARIABLE%GETDV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              DV = VARIABLE%GETDV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              DV = VARIABLE%GETDV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
      
    END SUBROUTINE BCWALLVISCOUS
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCWALLVISCOUSKE(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())

      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              DV = VARIABLE%GETDV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8,9)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              DV = VARIABLE%GETDV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8,9)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              DV = VARIABLE%GETDV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8,9)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              DV = VARIABLE%GETDV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8,9)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              DV = VARIABLE%GETDV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8,9)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              DV = VARIABLE%GETDV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8,9)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
      
    END SUBROUTINE BCWALLVISCOUSKE
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCWALLVISCOUSKW(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV()),GRD(GRID%GETNGRD())
      REAL(8) :: X(3),X1(3),X2(3),X3(3),VAR,XCC,YCC,ZCC

      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              DV = VARIABLE%GETDV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE(9)
                  X = GRID%GETX(BCINFO%IEND(1)+1,J,K)
                  X1 = GRID%GETX(BCINFO%IEND(1)+1,J+1,K)
                  X2 = GRID%GETX(BCINFO%IEND(1)+1,J,K+1)
                  X3 = GRID%GETX(BCINFO%IEND(1)+1,J+1,K+1)
                  GRD = GRID%GETGRD(BCINFO%IEND(1)+1,J,K)
                  XCC = 0.25D0*(X(1)+X1(1)+X2(1)+X3(1))
                  YCC = 0.25D0*(X(2)+X1(2)+X2(2)+X3(2))
                  ZCC = 0.25D0*(X(3)+X1(3)+X2(3)+X3(3))
                  VAR = 1600.D0*TV(1)/DV(1)/((GRD(2)-XCC)**2+(GRD(3)-YCC)**2+(GRD(4)-ZCC)**2)-PV(M)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              DV = VARIABLE%GETDV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE(9)
                  X = GRID%GETX(BCINFO%ISTART(1),J,K)
                  X1 = GRID%GETX(BCINFO%ISTART(1),J+1,K)
                  X2 = GRID%GETX(BCINFO%ISTART(1),J,K+1)
                  X3 = GRID%GETX(BCINFO%ISTART(1),J+1,K+1)
                  GRD = GRID%GETGRD(BCINFO%ISTART(1)-1,J,K)
                  XCC = 0.25D0*(X(1)+X1(1)+X2(1)+X3(1))
                  YCC = 0.25D0*(X(2)+X1(2)+X2(2)+X3(2))
                  ZCC = 0.25D0*(X(3)+X1(3)+X2(3)+X3(3))
                  VAR = 1600.D0*TV(1)/DV(1)/((GRD(2)-XCC)**2+(GRD(3)-YCC)**2+(GRD(4)-ZCC)**2)-PV(M)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              DV = VARIABLE%GETDV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE(9)
                  X = GRID%GETX(I,BCINFO%IEND(2)+1,K)
                  X1 = GRID%GETX(I+1,BCINFO%IEND(2)+1,K)
                  X2 = GRID%GETX(I,BCINFO%IEND(2)+1,K+1)
                  X3 = GRID%GETX(I+1,BCINFO%IEND(2)+1,K+1)
                  GRD = GRID%GETGRD(I,BCINFO%IEND(2)+1,K)
                  XCC = 0.25D0*(X(1)+X1(1)+X2(1)+X3(1))
                  YCC = 0.25D0*(X(2)+X1(2)+X2(2)+X3(2))
                  ZCC = 0.25D0*(X(3)+X1(3)+X2(3)+X3(3))
                  VAR = 1600.D0*TV(1)/DV(1)/((GRD(2)-XCC)**2+(GRD(3)-YCC)**2+(GRD(4)-ZCC)**2)-PV(M)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              DV = VARIABLE%GETDV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE(9)
                  X = GRID%GETX(I,BCINFO%ISTART(2),K)
                  X1 = GRID%GETX(I+1,BCINFO%ISTART(2),K)
                  X2 = GRID%GETX(I,BCINFO%ISTART(2),K+1)
                  X3 = GRID%GETX(I+1,BCINFO%ISTART(2),K+1)
                  GRD = GRID%GETGRD(I,BCINFO%ISTART(2)-1,K)
                  XCC = 0.25D0*(X(1)+X1(1)+X2(1)+X3(1))
                  YCC = 0.25D0*(X(2)+X1(2)+X2(2)+X3(2))
                  ZCC = 0.25D0*(X(3)+X1(3)+X2(3)+X3(3))
                  VAR = 1600.D0*TV(1)/DV(1)/((GRD(2)-XCC)**2+(GRD(3)-YCC)**2+(GRD(4)-ZCC)**2)-PV(M)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              DV = VARIABLE%GETDV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE(9)
                  X = GRID%GETX(I,J,BCINFO%IEND(3)+1)
                  X1 = GRID%GETX(I+1,J,BCINFO%IEND(3)+1)
                  X2 = GRID%GETX(I,J+1,BCINFO%IEND(3)+1)
                  X3 = GRID%GETX(I+1,J+1,BCINFO%IEND(3)+1)
                  GRD = GRID%GETGRD(I,J,BCINFO%IEND(3)+1)
                  XCC = 0.25D0*(X(1)+X1(1)+X2(1)+X3(1))
                  YCC = 0.25D0*(X(2)+X1(2)+X2(2)+X3(2))
                  ZCC = 0.25D0*(X(3)+X1(3)+X2(3)+X3(3))
                  VAR = 1600.D0*TV(1)/DV(1)/((GRD(2)-XCC)**2+(GRD(3)-YCC)**2+(GRD(4)-ZCC)**2)-PV(M)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              DV = VARIABLE%GETDV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2,3,4,8)
                  CALL VARIABLE%SETPV(M,I,J,K,-PV(M))
                CASE(9)
                  X = GRID%GETX(I,J,BCINFO%ISTART(3))
                  X1 = GRID%GETX(I+1,J,BCINFO%ISTART(3))
                  X2 = GRID%GETX(I,J+1,BCINFO%ISTART(3))
                  X3 = GRID%GETX(I+1,J+1,BCINFO%ISTART(3))
                  GRD = GRID%GETGRD(I,J,BCINFO%ISTART(3)-1)
                  XCC = 0.25D0*(X(1)+X1(1)+X2(1)+X3(1))
                  YCC = 0.25D0*(X(2)+X1(2)+X2(2)+X3(2))
                  ZCC = 0.25D0*(X(3)+X1(3)+X2(3)+X3(3))
                  VAR = 1600.D0*TV(1)/DV(1)/((GRD(2)-XCC)**2+(GRD(3)-YCC)**2+(GRD(4)-ZCC)**2)-PV(M)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
      
      
    END SUBROUTINE BCWALLVISCOUSKW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCINFLOW(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      END SELECT
      
    END SUBROUTINE BCINFLOW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCINFLOWSUBSONIC(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              CALL VARIABLE%SETPV(1,I,J,K,PV(1))
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              CALL VARIABLE%SETPV(1,I,J,K,PV(1))
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              CALL VARIABLE%SETPV(1,I,J,K,PV(1))
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              CALL VARIABLE%SETPV(1,I,J,K,PV(1))
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              CALL VARIABLE%SETPV(1,I,J,K,PV(1))
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              CALL VARIABLE%SETPV(1,I,J,K,PV(1))
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
      
    END SUBROUTINE BCINFLOWSUBSONIC
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCINFLOWSUPERSONIC(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      REAL(8) :: TV(VARIABLE%GETNTV())
      INTEGER :: I,J,K,M
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                SELECT CASE(M)
                CASE(3)
                  CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                END SELECT
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                SELECT CASE(M)
                CASE(3)
                  CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                END SELECT
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                SELECT CASE(M)
                CASE(3)
                  CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                END SELECT
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K) 
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                SELECT CASE(M)
                CASE(3)
                  CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                END SELECT
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                SELECT CASE(M)
                CASE(3)
                  CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                END SELECT
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1) 
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                SELECT CASE(M)
                CASE(3)
                  CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                CASE DEFAULT
                  CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                END SELECT
              END DO
            END DO
          END DO
        END DO
      END SELECT

      
    END SUBROUTINE BCINFLOWSUPERSONIC
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCOUTFLOW(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
            
            END DO
          END DO
        END DO
      END SELECT
      
    END SUBROUTINE BCOUTFLOW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCOUTFLOWSUBSONIC(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              CALL VARIABLE%SETPV(1,I,J,K,0.D0)
              DO M=2,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
      
    END SUBROUTINE BCOUTFLOWSUBSONIC
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCOUTFLOWSUPERSONIC(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              DV = VARIABLE%GETDV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              DV = VARIABLE%GETDV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              DV = VARIABLE%GETDV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              DV = VARIABLE%GETDV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              DV = VARIABLE%GETDV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              DV = VARIABLE%GETDV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
    
    END SUBROUTINE BCOUTFLOWSUPERSONIC
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCFARFIELD(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: NX(3),VEL
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETCX(BCINFO%IEND(1),J,K)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              DV = VARIABLE%GETDV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              VEL = (PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/DSQRT(NX(1)**2+NX(2)**2+NX(3)**2)
              IF(VEL/DSQRT(DV(6)).GE.0.D0) THEN !OUT
                IF(VEL/DSQRT(DV(6)).GE.1.D0) THEN !SUPER                
                  DO M=1,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              ELSE ! IN
                IF(VEL/DSQRT(DV(6)).LE.-1.D0) THEN !SUPER
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    SELECT CASE(M)
                    CASE(3)
                      CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                    CASE DEFAULT
                      CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                    END SELECT
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,PV(1))
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              END IF
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETCX(BCINFO%ISTART(1)-1,J,K)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              DV = VARIABLE%GETDV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              VEL = (PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/DSQRT(NX(1)**2+NX(2)**2+NX(3)**2)
              IF(VEL/DSQRT(DV(6)).GE.0.D0) THEN !OUT
                IF(VEL/DSQRT(DV(6)).GE.1.D0) THEN !SUPER                
                  DO M=1,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              ELSE ! IN
                IF(VEL/DSQRT(DV(6)).LE.-1.D0) THEN !SUPER
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    SELECT CASE(M)
                    CASE(3)
                      CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                    CASE DEFAULT
                      CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                    END SELECT
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,PV(1))
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              END IF
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETEX(I,BCINFO%IEND(2),K)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              DV = VARIABLE%GETDV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              VEL = (PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/DSQRT(NX(1)**2+NX(2)**2+NX(3)**2)
              IF(VEL/DSQRT(DV(6)).GE.0.D0) THEN !OUT
                IF(VEL/DSQRT(DV(6)).GE.1.D0) THEN !SUPER                
                  DO M=1,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              ELSE ! IN
                IF(VEL/DSQRT(DV(6)).LE.-1.D0) THEN !SUPER
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    SELECT CASE(M)
                    CASE(3)
                      CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                    CASE DEFAULT
                      CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                    END SELECT
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,PV(1))
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              END IF
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETEX(I,BCINFO%ISTART(2)-1,K)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              DV = VARIABLE%GETDV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              VEL = (PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/DSQRT(NX(1)**2+NX(2)**2+NX(3)**2)
              IF(VEL/DSQRT(DV(6)).GE.0.D0) THEN !OUT
                IF(VEL/DSQRT(DV(6)).GE.1.D0) THEN !SUPER                
                  DO M=1,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              ELSE ! IN
                IF(VEL/DSQRT(DV(6)).LE.-1.D0) THEN !SUPER
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    SELECT CASE(M)
                    CASE(3)
                      CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                    CASE DEFAULT
                      CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                    END SELECT
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,PV(1))
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              END IF
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETEX(I,J,BCINFO%IEND(3))
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              DV = VARIABLE%GETDV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              VEL = (PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/DSQRT(NX(1)**2+NX(2)**2+NX(3)**2)
              IF(VEL/DSQRT(DV(6)).GE.0.D0) THEN !OUT
                IF(VEL/DSQRT(DV(6)).GE.1.D0) THEN !SUPER                
                  DO M=1,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              ELSE ! IN
                IF(VEL/DSQRT(DV(6)).LE.-1.D0) THEN !SUPER
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    SELECT CASE(M)
                    CASE(3)
                      CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                    CASE DEFAULT
                      CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                    END SELECT
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,PV(1))
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              END IF
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETEX(I,J,BCINFO%ISTART(3)-1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              DV = VARIABLE%GETDV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              VEL = (PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/DSQRT(NX(1)**2+NX(2)**2+NX(3)**2)
              IF(VEL/DSQRT(DV(6)).GE.0.D0) THEN !OUT
                IF(VEL/DSQRT(DV(6)).GE.1.D0) THEN !SUPER                
                  DO M=1,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                  END DO
                  CALL EOS%DETEOS(REF%PV(1),PV(5),PV(6),PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),PV(5),PV(6),PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              ELSE ! IN
                IF(VEL/DSQRT(DV(6)).LE.-1.D0) THEN !SUPER
                  CALL VARIABLE%SETPV(1,I,J,K,0.D0)
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,REF%DV(M))
                  END DO
                  DO M=1,VARIABLE%GETNTV()
                    SELECT CASE(M)
                    CASE(3)
                      CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                    CASE DEFAULT
                      CALL VARIABLE%SETTV(M,I,J,K,REF%TV(M))
                    END SELECT
                  END DO
                ELSE !SUB
                  CALL VARIABLE%SETPV(1,I,J,K,PV(1))
                  DO M=2,VARIABLE%GETNPV()
                    CALL VARIABLE%SETPV(M,I,J,K,REF%PV(M))
                  END DO
                  CALL EOS%DETEOS(PV(1)+REF%PV(1),REF%PV(5),REF%PV(6),REF%PV(7),DV)
                  DO M=1,VARIABLE%GETNDV()
                    CALL VARIABLE%SETDV(M,I,J,K,DV(M))
                  END DO
                  IF(VARIABLE%GETNTV().NE.0) CALL PROP%DETPROP(DV(3),DV(4),DV(5),REF%PV(5),REF%PV(6),REF%PV(7),TV(1:2))
                  DO M=1,VARIABLE%GETNTV()
                    CALL VARIABLE%SETTV(M,I,J,K,TV(M))
                  END DO
                END IF
              END IF
            END DO
          END DO
        END DO
      END SELECT
    
    END SUBROUTINE BCFARFIELD
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCDEGENERATEPOINT(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%IEND(1)+1,J,K)
              DV = VARIABLE%GETDV(BCINFO%IEND(1)+1,J,K)
              TV = VARIABLE%GETTV(BCINFO%IEND(1)+1,J,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(BCINFO%ISTART(1)-1,J,K)
              DV = VARIABLE%GETDV(BCINFO%ISTART(1)-1,J,K)
              TV = VARIABLE%GETTV(BCINFO%ISTART(1)-1,J,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%IEND(2)+1,K)
              DV = VARIABLE%GETDV(I,BCINFO%IEND(2)+1,K)
              TV = VARIABLE%GETTV(I,BCINFO%IEND(2)+1,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,BCINFO%ISTART(2)-1,K)
              DV = VARIABLE%GETDV(I,BCINFO%ISTART(2)-1,K)
              TV = VARIABLE%GETTV(I,BCINFO%ISTART(2)-1,K)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%IEND(3)+1)
              DV = VARIABLE%GETDV(I,J,BCINFO%IEND(3)+1)
              TV = VARIABLE%GETTV(I,J,BCINFO%IEND(3)+1)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              PV = VARIABLE%GETPV(I,J,BCINFO%ISTART(3)-1)
              DV = VARIABLE%GETDV(I,J,BCINFO%ISTART(3)-1)
              TV = VARIABLE%GETTV(I,J,BCINFO%ISTART(3)-1)
              DO M=1,VARIABLE%GETNPV()
                CALL VARIABLE%SETPV(M,I,J,K,PV(M))
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
    
    END SUBROUTINE BCDEGENERATEPOINT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE BCSYMMETRYPLANE(BCINFO,REF,GRID,VARIABLE,EOS,PROP)
      IMPLICIT NONE
      CLASS(T_BCINFO_P), INTENT(IN) :: BCINFO
      TYPE(T_REF), INTENT(IN) :: REF
      TYPE(T_GRID), INTENT(IN) :: GRID
      TYPE(T_VARIABLE), INTENT(INOUT) :: VARIABLE
      TYPE(T_EOS), INTENT(IN) :: EOS
      TYPE(T_PROP), INTENT(IN) :: PROP
      INTEGER :: I,J,K,M,II,JJ,KK
      REAL(8) :: PV(VARIABLE%GETNPV()),DV(VARIABLE%GETNDV()),TV(VARIABLE%GETNTV())
      REAL(8) :: VAR,NX(3)
      
      SELECT CASE(BCINFO%FACE)
      CASE('IMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETCX(BCINFO%IEND(1),J,K)
              II = BCINFO%IEND(1)-I + BCINFO%IEND(1)+1
              PV = VARIABLE%GETPV(II,J,K)
              DV = VARIABLE%GETDV(II,J,K)
              TV = VARIABLE%GETTV(II,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('IMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETCX(BCINFO%ISTART(1)-1,J,K)
              II = BCINFO%ISTART(1)-I + BCINFO%ISTART(1)-1
              PV = VARIABLE%GETPV(II,J,K)
              DV = VARIABLE%GETDV(II,J,K)
              TV = VARIABLE%GETTV(II,J,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETEX(I,BCINFO%IEND(2),K)
              JJ = BCINFO%IEND(2)-J + BCINFO%IEND(2)+1
              PV = VARIABLE%GETPV(I,JJ,K)
              DV = VARIABLE%GETDV(I,JJ,K)
              TV = VARIABLE%GETTV(I,JJ,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('JMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETEX(I,BCINFO%ISTART(2)-1,K)
              JJ = BCINFO%ISTART(2)-J + BCINFO%ISTART(2)-1
              PV = VARIABLE%GETPV(I,JJ,K)
              DV = VARIABLE%GETDV(I,JJ,K)
              TV = VARIABLE%GETTV(I,JJ,K)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMIN')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = GRID%GETTX(I,J,BCINFO%IEND(3))
              KK = BCINFO%IEND(3)-K + BCINFO%IEND(3)+1
              PV = VARIABLE%GETPV(I,J,KK)
              DV = VARIABLE%GETDV(I,J,KK)
              TV = VARIABLE%GETTV(I,J,KK)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      CASE('KMAX')
        DO K=BCINFO%ISTART(3),BCINFO%IEND(3)
          DO J=BCINFO%ISTART(2),BCINFO%IEND(2)
            DO I=BCINFO%ISTART(1),BCINFO%IEND(1)
              NX = - GRID%GETTX(I,J,BCINFO%ISTART(3)-1)
              KK = BCINFO%ISTART(3)-K + BCINFO%ISTART(3)-1
              PV = VARIABLE%GETPV(I,J,KK)
              DV = VARIABLE%GETDV(I,J,KK)
              TV = VARIABLE%GETTV(I,J,KK)
              DO M=1,VARIABLE%GETNPV()
                SELECT CASE(M)
                CASE(2)
                  VAR = PV(2)-2.D0*NX(1)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(3)
                  VAR = PV(3)-2.D0*NX(2)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE(4)
                  VAR = PV(4)-2.D0*NX(3)*(PV(2)*NX(1)+PV(3)*NX(2)+PV(4)*NX(3))/(NX(1)**2+NX(2)**2+NX(3)**2)
                  CALL VARIABLE%SETPV(M,I,J,K,VAR)
                CASE DEFAULT
                  CALL VARIABLE%SETPV(M,I,J,K,PV(M))
                END SELECT
              END DO
              DO M=1,VARIABLE%GETNDV()
                CALL VARIABLE%SETDV(M,I,J,K,DV(M))
              END DO
              DO M=1,VARIABLE%GETNTV()
                CALL VARIABLE%SETTV(M,I,J,K,TV(M))
              END DO
            END DO
          END DO
        END DO
      END SELECT
    END SUBROUTINE BCSYMMETRYPLANE
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
END MODULE BC_MODULE
