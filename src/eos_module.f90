MODULE EOS_MODULE
  IMPLICIT NONE
  PRIVATE
  PUBLIC :: T_EOS
    
  TYPE T_IAPWS_COEFF
    INTEGER, DIMENSION(:), ALLOCATABLE :: I,J,IR,JR
    REAL(8), DIMENSION(:), ALLOCATABLE :: N,NR
  END TYPE T_IAPWS_COEFF
  
  TYPE T_SRK_PROPERTY
    REAL(8) :: TC, PC, TB, MW, W, K, CV0
  END TYPE T_SRK_PROPERTY
  
  TYPE T_EOS
    PRIVATE
    PROCEDURE(P_PWW), PUBLIC, POINTER :: GET_PWW
    PROCEDURE(P_SIGMA), PUBLIC, POINTER :: GET_SIGMA
    PROCEDURE(P_DETEOS), PUBLIC, POINTER :: DETEOS
    PROCEDURE(P_EOS_L), POINTER :: EOS_L
    PROCEDURE(P_EOS_V), POINTER :: EOS_V
    PROCEDURE(P_EOS_G), POINTER :: EOS_G
    TYPE(T_IAPWS_COEFF) :: IAPWS_LIQUID_COEFF,IAPWS_VAPOR_COEFF,IAPWS_M_VAPOR_COEFF
    TYPE(T_SRK_PROPERTY) :: SRK_VAPOR_PROPERTY, SRK_GAS_PROPERTY
    CONTAINS
      PROCEDURE :: CONSTRUCT !(FLUID,EOS_TYPE,N_GAS)
      PROCEDURE, PRIVATE :: SET_IAPWS97
      PROCEDURE, PRIVATE :: SET_SRK_PROPERTY
      PROCEDURE, PRIVATE :: SET_SRK_BINARY
      PROCEDURE, PRIVATE :: SRK_M
      PROCEDURE :: DESTRUCT
  END TYPE T_EOS

  TYPE T_EOS2
    REAL(8) :: RHO,H,DRDP,DRDT,DHDP,DHDT,CV
  END TYPE T_EOS2

  TYPE T_SRK_COEFF
    REAL(8) :: A, ALPHA, B, S
  END TYPE T_SRK_COEFF
  
  INTERFACE
    FUNCTION P_PWW(EOS,T) RESULT(PWW)
      IMPORT T_EOS
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: PWW
    END FUNCTION P_PWW
    
    FUNCTION P_SIGMA(EOS,T) RESULT(SIGMA)
      IMPORT T_EOS
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: SIGMA
    END FUNCTION P_SIGMA
    
    SUBROUTINE P_DETEOS(EOS,P,T,Y1,Y2,DV)
      IMPORT T_EOS
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T,Y1,Y2
      REAL(8), INTENT(OUT) :: DV(18)
    END SUBROUTINE P_DETEOS
    
    SUBROUTINE P_EOS_L(EOS,P,T,LIQUID)
      IMPORT T_EOS
      IMPORT T_EOS2
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID
    END SUBROUTINE P_EOS_L
    
    SUBROUTINE P_EOS_V(EOS,P,T,VAPOR)
      IMPORT T_EOS
      IMPORT T_EOS2
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
    END SUBROUTINE P_EOS_V
    
    SUBROUTINE P_EOS_G(EOS,P,T,GAS)
      IMPORT T_EOS
      IMPORT T_EOS2
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: GAS
    END SUBROUTINE P_EOS_G
  END INTERFACE

  CONTAINS
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC    
    SUBROUTINE CONSTRUCT(EOS,FLUID,FLUID_EOSTYPE,NGAS,GAS_EOSTYPE,MIXINGRULE)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(OUT) :: EOS
      INTEGER, INTENT(IN) :: FLUID,FLUID_EOSTYPE,NGAS,GAS_EOSTYPE,MIXINGRULE
      
      SELECT CASE(MIXINGRULE) ! MIXING RULE FOR ULLAGE
        CASE(1) ! AMAGAT'S LAW
          EOS%DETEOS => DETEOS_AMAGAT
        CASE(2) ! DALTON'S LAW
          EOS%DETEOS => DETEOS_DALTON
      END SELECT
      
      SELECT CASE(GAS_EOSTYPE)
      CASE(1) ! FITTING OR IDEAL GAS LAW  
        SELECT CASE(NGAS)
        CASE(1) ! IDEAL GAS
          EOS%EOS_G => IDEAL
        CASE(2) ! NITROGEN
          EOS%EOS_G => N2_V_FIT
        CASE(3) ! OXYGEN
          EOS%EOS_G => O2_V_FIT
        CASE(4) ! HYDROGEN
          EOS%EOS_G => H2_V_FIT
        CASE(5) ! HELIUM
          EOS%EOS_G => HE_V_FIT
        CASE DEFAULT  
        END SELECT
      CASE(2) ! SRK
        CALL EOS%SET_SRK_PROPERTY(NGAS,2)
        CALL EOS%SET_SRK_BINARY(FLUID,NGAS)
        EOS%EOS_G => SRK_G
      CASE DEFAULT  
      END SELECT
      
      SELECT CASE(FLUID)
      CASE(1) ! WATER
        EOS%GET_PWW => H2O_PWW
        EOS%GET_SIGMA => H2O_SIGMA
        SELECT CASE(FLUID_EOSTYPE)
        CASE(1) ! FITTING
          EOS%EOS_L  => H2O_L_FIT
          EOS%EOS_V  => H2O_V_FIT
        CASE(2) ! IAPWS97
          CALL EOS%SET_IAPWS97()
          EOS%EOS_L  => IAPWS97_L
          EOS%EOS_V  => IAPWS97_V
        CASE(3) ! STIFFENED
          EOS%EOS_L  => STIFFENED
          EOS%EOS_V  => IDEAL
        END SELECT

      CASE(2) ! NITROGEN
        EOS%GET_PWW => N2_PWW
        EOS%GET_SIGMA => N2_SIGMA
        EOS%EOS_L  => N2_L_FIT
        SELECT CASE(FLUID_EOSTYPE)
        CASE(1) ! FITTING
          EOS%EOS_V  => N2_V_FIT
        CASE(2) ! SRK
          CALL EOS%SET_SRK_PROPERTY(FLUID,1)
          EOS%EOS_V => SRK_V
        CASE DEFAULT
        END SELECT
      
      CASE(3) ! OXYGEN
        EOS%GET_PWW => O2_PWW
        EOS%GET_SIGMA => O2_SIGMA
        EOS%EOS_L  => O2_L_FIT
        SELECT CASE(FLUID_EOSTYPE)
        CASE(1) ! FITTING
          EOS%EOS_V  => O2_V_FIT
        CASE(2) ! SRK
          CALL EOS%SET_SRK_PROPERTY(FLUID,1)
          EOS%EOS_V => SRK_V
        CASE DEFAULT
        END SELECT
        
      CASE(4) ! HYDROGEN
        EOS%GET_PWW => H2_PWW
        EOS%GET_SIGMA => H2_SIGMA
        EOS%EOS_L  => H2_L_FIT
        SELECT CASE(FLUID_EOSTYPE)
        CASE(1) ! FITTING
          EOS%EOS_V  => H2_V_FIT
        CASE(2) ! SRK
          CALL EOS%SET_SRK_PROPERTY(FLUID,1)
          EOS%EOS_V => SRK_V     
        CASE DEFAULT
        END SELECT
      END SELECT
    
    END SUBROUTINE CONSTRUCT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC    
    SUBROUTINE DESTRUCT(EOS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(INOUT) :: EOS
    
      IF(ASSOCIATED(EOS%GET_PWW))   NULLIFY(EOS%GET_PWW)
      IF(ASSOCIATED(EOS%GET_SIGMA)) NULLIFY(EOS%GET_SIGMA)
      IF(ASSOCIATED(EOS%DETEOS))    NULLIFY(EOS%DETEOS)
      IF(ASSOCIATED(EOS%EOS_L))     NULLIFY(EOS%EOS_L)
      IF(ASSOCIATED(EOS%EOS_V))     NULLIFY(EOS%EOS_V)
      IF(ASSOCIATED(EOS%EOS_G))     NULLIFY(EOS%EOS_G)
      
      IF(ALLOCATED(EOS%IAPWS_LIQUID_COEFF%I)) DEALLOCATE(EOS%IAPWS_LIQUID_COEFF%I)
      IF(ALLOCATED(EOS%IAPWS_LIQUID_COEFF%J)) DEALLOCATE(EOS%IAPWS_LIQUID_COEFF%J)
      IF(ALLOCATED(EOS%IAPWS_LIQUID_COEFF%N)) DEALLOCATE(EOS%IAPWS_LIQUID_COEFF%N)
      IF(ALLOCATED(EOS%IAPWS_VAPOR_COEFF%J)) DEALLOCATE(EOS%IAPWS_VAPOR_COEFF%J)
      IF(ALLOCATED(EOS%IAPWS_VAPOR_COEFF%N)) DEALLOCATE(EOS%IAPWS_VAPOR_COEFF%N)
      IF(ALLOCATED(EOS%IAPWS_VAPOR_COEFF%IR)) DEALLOCATE(EOS%IAPWS_VAPOR_COEFF%IR)
      IF(ALLOCATED(EOS%IAPWS_VAPOR_COEFF%JR)) DEALLOCATE(EOS%IAPWS_VAPOR_COEFF%JR)
      IF(ALLOCATED(EOS%IAPWS_VAPOR_COEFF%NR)) DEALLOCATE(EOS%IAPWS_VAPOR_COEFF%NR)
      IF(ALLOCATED(EOS%IAPWS_M_VAPOR_COEFF%J)) DEALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%J)
      IF(ALLOCATED(EOS%IAPWS_M_VAPOR_COEFF%N)) DEALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%N)
      IF(ALLOCATED(EOS%IAPWS_M_VAPOR_COEFF%IR)) DEALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%IR)
      IF(ALLOCATED(EOS%IAPWS_M_VAPOR_COEFF%JR)) DEALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%JR)
      IF(ALLOCATED(EOS%IAPWS_M_VAPOR_COEFF%NR)) DEALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%NR)
      
    END SUBROUTINE DESTRUCT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE DETEOS_AMAGAT(EOS,P,T,Y1,Y2,DV)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T,Y1,Y2
      REAL(8), INTENT(OUT) :: DV(18) ! RHO,H,RHOL,RHOV,RHOG,SND2,DRDP,DRDT,DRDY1,DRDY2,DHDP,DHDT,DHDY1,DHDY2,DRDPV,DRDTV,DRDPL,DRDTL
      TYPE(T_EOS2) :: LIQUID,VAPOR,GAS
      
      CALL EOS%EOS_L(P,T,LIQUID)
      CALL EOS%EOS_V(P,T,VAPOR)
      CALL EOS%EOS_G(P,T,GAS)    
      
      DV(3)  = LIQUID%RHO
      DV(4)  = VAPOR%RHO
      DV(5)  = GAS%RHO
    
      DV(1)  = 1.D0/((1.D0-Y1-Y2)/LIQUID%RHO + Y1/VAPOR%RHO + Y2/GAS%RHO)
      DV(2)  = (1.D0-Y1-Y2)*LIQUID%H + Y1*VAPOR%H + Y2*GAS%H
    
      DV(7)  = DV(1)**2*((1.D0-Y1-Y2)/LIQUID%RHO**2*LIQUID%DRDP &
                                 + Y1/VAPOR%RHO**2*VAPOR%DRDP   &
                                 + Y2/GAS%RHO**2*GAS%DRDP)
      DV(8)  = DV(1)**2*((1.D0-Y1-Y2)/LIQUID%RHO**2*LIQUID%DRDT &
                                 + Y1/VAPOR%RHO**2*VAPOR%DRDT   &
                                 + Y2/GAS%RHO**2*GAS%DRDT)
      DV(9)  = DV(1)**2*(1.D0/LIQUID%RHO - 1.D0/VAPOR%RHO)
      DV(10) = DV(1)**2*(1.D0/LIQUID%RHO - 1.D0/GAS%RHO)
    
      DV(11) = (1.D0-Y1-Y2)*LIQUID%DHDP + Y1*VAPOR%DHDP + Y2*GAS%DHDP
      DV(12) = (1.D0-Y1-Y2)*LIQUID%DHDT + Y1*VAPOR%DHDT + Y2*GAS%DHDT
      DV(13) = VAPOR%H - LIQUID%H
      DV(14) = GAS%H   - LIQUID%H
      
      DV(6)  = DV(1)*DV(12)/(DV(1)*DV(7)*DV(12)+DV(8)*(1.D0-DV(1)*DV(11)))
      
      DV(15) = VAPOR%DRDP
      DV(16) = VAPOR%DRDT
      DV(17) = LIQUID%DRDP
      DV(18) = LIQUID%DRDT
    
    END SUBROUTINE DETEOS_AMAGAT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE DETEOS_DALTON(EOS,P,T,Y1,Y2,DV)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T,Y1,Y2
      REAL(8), INTENT(OUT) :: DV(18) ! RHO,H,RHOL,RHOV,RHOG,SND2,DRDP,DRDT,DRDY1,DRDY2,DHDP,DHDT,DHDY1,DHDY2,DRDPV,DRDTV,DRDPL,DRDTL
      TYPE(T_EOS2) :: LIQUID,ULLAGE,VAPOR,GAS
      REAL(8) :: CV
      
      CALL EOS%EOS_L(P,T,LIQUID)
      CALL EOS%EOS_V(P,T,VAPOR)
      CALL EOS%EOS_G(P,T,GAS)
      CALL EOS%SRK_M(P,T,Y1,Y2,ULLAGE)
    
      DV(3)  = LIQUID%RHO
      DV(4)  = VAPOR%RHO
      DV(5)  = GAS%RHO
    
      DV(1)  = 1.D0/((1.D0-Y1-Y2)/LIQUID%RHO + (Y1+Y2)/ULLAGE%RHO)
      DV(2)  = (1.D0-Y1-Y2)*LIQUID%H + (Y1+Y2)*ULLAGE%H
    
      DV(7)  = DV(1)**2*((1.D0-Y1-Y2)/LIQUID%RHO**2*LIQUID%DRDP &
                        +     (Y1+Y2)/ULLAGE%RHO**2*ULLAGE%DRDP )   
      DV(8)  = DV(1)**2*((1.D0-Y1-Y2)/LIQUID%RHO**2*LIQUID%DRDT &
                        +     (Y1+Y2)/ULLAGE%RHO**2*ULLAGE%DRDT )  
      DV(9)  = DV(1)**2*(1.D0/LIQUID%RHO - 1.D0/DV(4)) !WARNING
      DV(10) = DV(1)**2*(1.D0/LIQUID%RHO - 1.D0/DV(5)) !WARNING
    
      DV(11) = (1.D0-Y1-Y2)*LIQUID%DHDP + (Y1+Y2)*ULLAGE%DHDP
      DV(12) = (1.D0-Y1-Y2)*LIQUID%DHDT + (Y1+Y2)*ULLAGE%DHDT
      DV(13) = VAPOR%H - LIQUID%H !WARNING
      DV(14) = GAS%H - LIQUID%H !WARNING
      
      CV = (1.D0-Y1-Y2)*LIQUID%CV + (Y1+Y2)*ULLAGE%CV
      DV(6) = DV(12)/CV/DV(7)
      
      DV(15) = VAPOR%DRDP
      DV(16) = VAPOR%DRDT
      DV(17) = LIQUID%DRDP
      DV(18) = LIQUID%DRDT
    
    END SUBROUTINE DETEOS_DALTON
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE SET_IAPWS97(EOS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(INOUT) :: EOS
     
      ALLOCATE(EOS%IAPWS_LIQUID_COEFF%I(34),EOS%IAPWS_LIQUID_COEFF%J(34),EOS%IAPWS_LIQUID_COEFF%N(34))
     
      ALLOCATE(EOS%IAPWS_VAPOR_COEFF%J(9),EOS%IAPWS_VAPOR_COEFF%N(9))
      ALLOCATE(EOS%IAPWS_VAPOR_COEFF%IR(43),EOS%IAPWS_VAPOR_COEFF%JR(43),EOS%IAPWS_VAPOR_COEFF%NR(43))
     
      ALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%J(9),EOS%IAPWS_M_VAPOR_COEFF%N(9))
      ALLOCATE(EOS%IAPWS_M_VAPOR_COEFF%IR(13),EOS%IAPWS_M_VAPOR_COEFF%JR(13),EOS%IAPWS_M_VAPOR_COEFF%NR(13))

      EOS%IAPWS_LIQUID_COEFF%I(1)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(1)  =   -2;    EOS%IAPWS_LIQUID_COEFF%N(1)  =   0.14632971213167D0      
      EOS%IAPWS_LIQUID_COEFF%I(2)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(2)  =   -1;    EOS%IAPWS_LIQUID_COEFF%N(2)  = - 0.84548187169114D0
      EOS%IAPWS_LIQUID_COEFF%I(3)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(3)  =    0;    EOS%IAPWS_LIQUID_COEFF%N(3)  = - 0.37563603672040D1
      EOS%IAPWS_LIQUID_COEFF%I(4)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(4)  =    1;    EOS%IAPWS_LIQUID_COEFF%N(4)  =   0.33855169168385D1
      EOS%IAPWS_LIQUID_COEFF%I(5)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(5)  =    2;    EOS%IAPWS_LIQUID_COEFF%N(5)  = - 0.95791963387872D0
      EOS%IAPWS_LIQUID_COEFF%I(6)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(6)  =    3;    EOS%IAPWS_LIQUID_COEFF%N(6)  =   0.15772038513228D0
      EOS%IAPWS_LIQUID_COEFF%I(7)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(7)  =    4;    EOS%IAPWS_LIQUID_COEFF%N(7)  = - 0.16616417199501D-1 
      EOS%IAPWS_LIQUID_COEFF%I(8)  =  0;     EOS%IAPWS_LIQUID_COEFF%J(8)  =    5;    EOS%IAPWS_LIQUID_COEFF%N(8)  =   0.81214629983568D-3
      EOS%IAPWS_LIQUID_COEFF%I(9)  =  1;     EOS%IAPWS_LIQUID_COEFF%J(9)  =   -9;    EOS%IAPWS_LIQUID_COEFF%N(9)  =   0.28319080123804D-3
      EOS%IAPWS_LIQUID_COEFF%I(10) =  1;     EOS%IAPWS_LIQUID_COEFF%J(10)  =  -7;    EOS%IAPWS_LIQUID_COEFF%N(10) = - 0.60706301565874D-3
      EOS%IAPWS_LIQUID_COEFF%I(11) =  1;     EOS%IAPWS_LIQUID_COEFF%J(11)  =  -1;    EOS%IAPWS_LIQUID_COEFF%N(11) = - 0.18990068218419D-1
      EOS%IAPWS_LIQUID_COEFF%I(12) =  1;     EOS%IAPWS_LIQUID_COEFF%J(12)  =   0;    EOS%IAPWS_LIQUID_COEFF%N(12) = - 0.32529748770505D-1
      EOS%IAPWS_LIQUID_COEFF%I(13) =  1;     EOS%IAPWS_LIQUID_COEFF%J(13)  =   1;    EOS%IAPWS_LIQUID_COEFF%N(13) = - 0.21841717175414D-1
      EOS%IAPWS_LIQUID_COEFF%I(14) =  1;     EOS%IAPWS_LIQUID_COEFF%J(14)  =   3;    EOS%IAPWS_LIQUID_COEFF%N(14) = - 0.52838357969930D-4
      EOS%IAPWS_LIQUID_COEFF%I(15) =  2;     EOS%IAPWS_LIQUID_COEFF%J(15)  =  -3;    EOS%IAPWS_LIQUID_COEFF%N(15) = - 0.47184321073267D-3
      EOS%IAPWS_LIQUID_COEFF%I(16) =  2;     EOS%IAPWS_LIQUID_COEFF%J(16)  =   0;    EOS%IAPWS_LIQUID_COEFF%N(16) = - 0.30001780793026D-3
      EOS%IAPWS_LIQUID_COEFF%I(17) =  2;     EOS%IAPWS_LIQUID_COEFF%J(17)  =   1;    EOS%IAPWS_LIQUID_COEFF%N(17) =   0.47661393906987D-4
      EOS%IAPWS_LIQUID_COEFF%I(18) =  2;     EOS%IAPWS_LIQUID_COEFF%J(18)  =   3;    EOS%IAPWS_LIQUID_COEFF%N(18) = - 0.44141845330846D-5
      EOS%IAPWS_LIQUID_COEFF%I(19) =  2;     EOS%IAPWS_LIQUID_COEFF%J(19)  =  17;    EOS%IAPWS_LIQUID_COEFF%N(19) = - 0.72694996297594D-15
      EOS%IAPWS_LIQUID_COEFF%I(20) =  3;     EOS%IAPWS_LIQUID_COEFF%J(20)  =  -4;    EOS%IAPWS_LIQUID_COEFF%N(20) = - 0.31679644845054D-4 
      EOS%IAPWS_LIQUID_COEFF%I(21) =  3;     EOS%IAPWS_LIQUID_COEFF%J(21)  =   0;    EOS%IAPWS_LIQUID_COEFF%N(21) = - 0.28270797985312D-5
      EOS%IAPWS_LIQUID_COEFF%I(22) =  3;     EOS%IAPWS_LIQUID_COEFF%J(22)  =   6;    EOS%IAPWS_LIQUID_COEFF%N(22) = - 0.85205128120103D-9
      EOS%IAPWS_LIQUID_COEFF%I(23) =  4;     EOS%IAPWS_LIQUID_COEFF%J(23)  =  -5;    EOS%IAPWS_LIQUID_COEFF%N(23) = - 0.22425281908000D-5
      EOS%IAPWS_LIQUID_COEFF%I(24) =  4;     EOS%IAPWS_LIQUID_COEFF%J(24)  =  -2;    EOS%IAPWS_LIQUID_COEFF%N(24) = - 0.65171222895601D-6
      EOS%IAPWS_LIQUID_COEFF%I(25) =  4;     EOS%IAPWS_LIQUID_COEFF%J(25)  =  10;    EOS%IAPWS_LIQUID_COEFF%N(25) = - 0.14341729937924D-12
      EOS%IAPWS_LIQUID_COEFF%I(26) =  5;     EOS%IAPWS_LIQUID_COEFF%J(26)  =  -8;    EOS%IAPWS_LIQUID_COEFF%N(26) = - 0.40516996860117D-6
      EOS%IAPWS_LIQUID_COEFF%I(27) =  8;     EOS%IAPWS_LIQUID_COEFF%J(27)  = -11;    EOS%IAPWS_LIQUID_COEFF%N(27) = - 0.12734301741641D-8
      EOS%IAPWS_LIQUID_COEFF%I(28) =  8;     EOS%IAPWS_LIQUID_COEFF%J(28)  =  -6;    EOS%IAPWS_LIQUID_COEFF%N(28) = - 0.17424871230634D-9
      EOS%IAPWS_LIQUID_COEFF%I(29) = 21;     EOS%IAPWS_LIQUID_COEFF%J(29)  = -29;    EOS%IAPWS_LIQUID_COEFF%N(29) = - 0.68762131295531D-18
      EOS%IAPWS_LIQUID_COEFF%I(30) = 23;     EOS%IAPWS_LIQUID_COEFF%J(30)  = -31;    EOS%IAPWS_LIQUID_COEFF%N(30) =   0.14478307828521D-19
      EOS%IAPWS_LIQUID_COEFF%I(31) = 29;     EOS%IAPWS_LIQUID_COEFF%J(31)  = -38;    EOS%IAPWS_LIQUID_COEFF%N(31) =   0.26335781662795D-22
      EOS%IAPWS_LIQUID_COEFF%I(32) = 30;     EOS%IAPWS_LIQUID_COEFF%J(32)  = -39;    EOS%IAPWS_LIQUID_COEFF%N(32) = - 0.11947622640071D-22
      EOS%IAPWS_LIQUID_COEFF%I(33) = 31;     EOS%IAPWS_LIQUID_COEFF%J(33)  = -40;    EOS%IAPWS_LIQUID_COEFF%N(33) =   0.18228094581404D-23
      EOS%IAPWS_LIQUID_COEFF%I(34) = 32;     EOS%IAPWS_LIQUID_COEFF%J(34)  = -41;    EOS%IAPWS_LIQUID_COEFF%N(34) = - 0.93537087292458D-25  

      EOS%IAPWS_VAPOR_COEFF%J(1)  =    0;    EOS%IAPWS_VAPOR_COEFF%N(1)  = - 0.96927686500217D1     
      EOS%IAPWS_VAPOR_COEFF%J(2)  =    1;    EOS%IAPWS_VAPOR_COEFF%N(2)  =   0.10086655968018D2
      EOS%IAPWS_VAPOR_COEFF%J(3)  =   -5;    EOS%IAPWS_VAPOR_COEFF%N(3)  = - 0.56087911283020D-2
      EOS%IAPWS_VAPOR_COEFF%J(4)  =   -4;    EOS%IAPWS_VAPOR_COEFF%N(4)  =   0.71452738081455D-1
      EOS%IAPWS_VAPOR_COEFF%J(5)  =   -3;    EOS%IAPWS_VAPOR_COEFF%N(5)  = - 0.40710498223928D0
      EOS%IAPWS_VAPOR_COEFF%J(6)  =   -2;    EOS%IAPWS_VAPOR_COEFF%N(6)  =   0.14240819171444D1
      EOS%IAPWS_VAPOR_COEFF%J(7)  =   -1;    EOS%IAPWS_VAPOR_COEFF%N(7)  = - 0.43839511319450D1
      EOS%IAPWS_VAPOR_COEFF%J(8)  =    2;    EOS%IAPWS_VAPOR_COEFF%N(8)  = - 0.28408632460772D0  
      EOS%IAPWS_VAPOR_COEFF%J(9)  =    3;    EOS%IAPWS_VAPOR_COEFF%N(9)  =   0.21268463753307D-1  

      EOS%IAPWS_M_VAPOR_COEFF%J(1)  =    0;    EOS%IAPWS_M_VAPOR_COEFF%N(1)  = - 0.96937268393049D1    
      EOS%IAPWS_M_VAPOR_COEFF%J(2)  =    1;    EOS%IAPWS_M_VAPOR_COEFF%N(2)  =   0.10087275970006D2
      EOS%IAPWS_M_VAPOR_COEFF%J(3)  =   -5;    EOS%IAPWS_M_VAPOR_COEFF%N(3)  = - 0.56087911283020D-2
      EOS%IAPWS_M_VAPOR_COEFF%J(4)  =   -4;    EOS%IAPWS_M_VAPOR_COEFF%N(4)  =   0.71452738081455D-1
      EOS%IAPWS_M_VAPOR_COEFF%J(5)  =   -3;    EOS%IAPWS_M_VAPOR_COEFF%N(5)  = - 0.40710498223928D0
      EOS%IAPWS_M_VAPOR_COEFF%J(6)  =   -2;    EOS%IAPWS_M_VAPOR_COEFF%N(6)  =   0.14240819171444D1
      EOS%IAPWS_M_VAPOR_COEFF%J(7)  =   -1;    EOS%IAPWS_M_VAPOR_COEFF%N(7)  = - 0.43839511319450D1
      EOS%IAPWS_M_VAPOR_COEFF%J(8)  =    2;    EOS%IAPWS_M_VAPOR_COEFF%N(8)  = - 0.28408632460772D0  
      EOS%IAPWS_M_VAPOR_COEFF%J(9)  =    3;    EOS%IAPWS_M_VAPOR_COEFF%N(9)  =   0.21268463753307D-1  

      EOS%IAPWS_VAPOR_COEFF%IR(1)  =  1;     EOS%IAPWS_VAPOR_COEFF%JR(1)  =    0;    EOS%IAPWS_VAPOR_COEFF%NR(1)  = - 0.17731742473213D-2
      EOS%IAPWS_VAPOR_COEFF%IR(2)  =  1;     EOS%IAPWS_VAPOR_COEFF%JR(2)  =    1;    EOS%IAPWS_VAPOR_COEFF%NR(2)  = - 0.17834862292358D-1
      EOS%IAPWS_VAPOR_COEFF%IR(3)  =  1;     EOS%IAPWS_VAPOR_COEFF%JR(3)  =    2;    EOS%IAPWS_VAPOR_COEFF%NR(3)  = - 0.45996013696365D-1
      EOS%IAPWS_VAPOR_COEFF%IR(4)  =  1;     EOS%IAPWS_VAPOR_COEFF%JR(4)  =    3;    EOS%IAPWS_VAPOR_COEFF%NR(4)  = - 0.57581259083432D-1
      EOS%IAPWS_VAPOR_COEFF%IR(5)  =  1;     EOS%IAPWS_VAPOR_COEFF%JR(5)  =    6;    EOS%IAPWS_VAPOR_COEFF%NR(5)  = - 0.50325278727930D-1
      EOS%IAPWS_VAPOR_COEFF%IR(6)  =  2;     EOS%IAPWS_VAPOR_COEFF%JR(6)  =    1;    EOS%IAPWS_VAPOR_COEFF%NR(6)  = - 0.33032641670203D-4
      EOS%IAPWS_VAPOR_COEFF%IR(7)  =  2;     EOS%IAPWS_VAPOR_COEFF%JR(7)  =    2;    EOS%IAPWS_VAPOR_COEFF%NR(7)  = - 0.18948987516315D-3
      EOS%IAPWS_VAPOR_COEFF%IR(8)  =  2;     EOS%IAPWS_VAPOR_COEFF%JR(8)  =    4;    EOS%IAPWS_VAPOR_COEFF%NR(8)  = - 0.39392777243355D-2
      EOS%IAPWS_VAPOR_COEFF%IR(9)  =  2;     EOS%IAPWS_VAPOR_COEFF%JR(9)  =    7;    EOS%IAPWS_VAPOR_COEFF%NR(9)  = - 0.43797295650573D-1
      EOS%IAPWS_VAPOR_COEFF%IR(10) =  2;     EOS%IAPWS_VAPOR_COEFF%JR(10)  =  36;    EOS%IAPWS_VAPOR_COEFF%NR(10) = - 0.26674547914087D-4
      EOS%IAPWS_VAPOR_COEFF%IR(11) =  3;     EOS%IAPWS_VAPOR_COEFF%JR(11)  =   0;    EOS%IAPWS_VAPOR_COEFF%NR(11) =   0.20481737692309D-7
      EOS%IAPWS_VAPOR_COEFF%IR(12) =  3;     EOS%IAPWS_VAPOR_COEFF%JR(12)  =   1;    EOS%IAPWS_VAPOR_COEFF%NR(12) =   0.43870667284435D-6
      EOS%IAPWS_VAPOR_COEFF%IR(13) =  3;     EOS%IAPWS_VAPOR_COEFF%JR(13)  =   3;    EOS%IAPWS_VAPOR_COEFF%NR(13) = - 0.32277677238570D-4
      EOS%IAPWS_VAPOR_COEFF%IR(14) =  3;     EOS%IAPWS_VAPOR_COEFF%JR(14)  =   6;    EOS%IAPWS_VAPOR_COEFF%NR(14) = - 0.15033924542148D-2
      EOS%IAPWS_VAPOR_COEFF%IR(15) =  3;     EOS%IAPWS_VAPOR_COEFF%JR(15)  =  35;    EOS%IAPWS_VAPOR_COEFF%NR(15) = - 0.40668253562649D-1
      EOS%IAPWS_VAPOR_COEFF%IR(16) =  4;     EOS%IAPWS_VAPOR_COEFF%JR(16)  =   1;    EOS%IAPWS_VAPOR_COEFF%NR(16) = - 0.78847309559367D-9
      EOS%IAPWS_VAPOR_COEFF%IR(17) =  4;     EOS%IAPWS_VAPOR_COEFF%JR(17)  =   2;    EOS%IAPWS_VAPOR_COEFF%NR(17) =   0.12790717852285D-7
      EOS%IAPWS_VAPOR_COEFF%IR(18) =  4;     EOS%IAPWS_VAPOR_COEFF%JR(18)  =   3;    EOS%IAPWS_VAPOR_COEFF%NR(18) =   0.48225372718507D-6
      EOS%IAPWS_VAPOR_COEFF%IR(19) =  5;     EOS%IAPWS_VAPOR_COEFF%JR(19)  =   7;    EOS%IAPWS_VAPOR_COEFF%NR(19) =   0.22922076337661D-5
      EOS%IAPWS_VAPOR_COEFF%IR(20) =  6;     EOS%IAPWS_VAPOR_COEFF%JR(20)  =   3;    EOS%IAPWS_VAPOR_COEFF%NR(20) = - 0.16714766451061D-10
      EOS%IAPWS_VAPOR_COEFF%IR(21) =  6;     EOS%IAPWS_VAPOR_COEFF%JR(21)  =  16;    EOS%IAPWS_VAPOR_COEFF%NR(21) = - 0.21171472321355D-2
      EOS%IAPWS_VAPOR_COEFF%IR(22) =  6;     EOS%IAPWS_VAPOR_COEFF%JR(22)  =  35;    EOS%IAPWS_VAPOR_COEFF%NR(22) = - 0.23895741934104D2
      EOS%IAPWS_VAPOR_COEFF%IR(23) =  7;     EOS%IAPWS_VAPOR_COEFF%JR(23)  =   0;    EOS%IAPWS_VAPOR_COEFF%NR(23) = - 0.59059564324270D-17
      EOS%IAPWS_VAPOR_COEFF%IR(24) =  7;     EOS%IAPWS_VAPOR_COEFF%JR(24)  =  11;    EOS%IAPWS_VAPOR_COEFF%NR(24) = - 0.12621808899101D-5
      EOS%IAPWS_VAPOR_COEFF%IR(25) =  7;     EOS%IAPWS_VAPOR_COEFF%JR(25)  =  25;    EOS%IAPWS_VAPOR_COEFF%NR(25) = - 0.38946842435739D-1
      EOS%IAPWS_VAPOR_COEFF%IR(26) =  8;     EOS%IAPWS_VAPOR_COEFF%JR(26)  =   8;    EOS%IAPWS_VAPOR_COEFF%NR(26) =   0.11256211360459D-10
      EOS%IAPWS_VAPOR_COEFF%IR(27) =  8;     EOS%IAPWS_VAPOR_COEFF%JR(27)  =  36;    EOS%IAPWS_VAPOR_COEFF%NR(27) = - 0.82311340897998D1
      EOS%IAPWS_VAPOR_COEFF%IR(28) =  9;     EOS%IAPWS_VAPOR_COEFF%JR(28)  =  13;    EOS%IAPWS_VAPOR_COEFF%NR(28) =   0.19809712802088D-7
      EOS%IAPWS_VAPOR_COEFF%IR(29) = 10;     EOS%IAPWS_VAPOR_COEFF%JR(29)  =   4;    EOS%IAPWS_VAPOR_COEFF%NR(29) =   0.10406965210174D-18
      EOS%IAPWS_VAPOR_COEFF%IR(30) = 10;     EOS%IAPWS_VAPOR_COEFF%JR(30)  =  10;    EOS%IAPWS_VAPOR_COEFF%NR(30) = - 0.10234747095929D-12
      EOS%IAPWS_VAPOR_COEFF%IR(31) = 10;     EOS%IAPWS_VAPOR_COEFF%JR(31)  =  14;    EOS%IAPWS_VAPOR_COEFF%NR(31) = - 0.10018179379511D-8
      EOS%IAPWS_VAPOR_COEFF%IR(32) = 16;     EOS%IAPWS_VAPOR_COEFF%JR(32)  =  29;    EOS%IAPWS_VAPOR_COEFF%NR(32) = - 0.80882908646985D-10
      EOS%IAPWS_VAPOR_COEFF%IR(33) = 16;     EOS%IAPWS_VAPOR_COEFF%JR(33)  =  50;    EOS%IAPWS_VAPOR_COEFF%NR(33) =   0.10693031879409D0
      EOS%IAPWS_VAPOR_COEFF%IR(34) = 18;     EOS%IAPWS_VAPOR_COEFF%JR(34)  =  57;    EOS%IAPWS_VAPOR_COEFF%NR(34) = - 0.33662250574171D0 
      EOS%IAPWS_VAPOR_COEFF%IR(35) = 20;     EOS%IAPWS_VAPOR_COEFF%JR(35)  =  20;    EOS%IAPWS_VAPOR_COEFF%NR(35) =   0.89185845355421D-24
      EOS%IAPWS_VAPOR_COEFF%IR(36) = 20;     EOS%IAPWS_VAPOR_COEFF%JR(36)  =  35;    EOS%IAPWS_VAPOR_COEFF%NR(36) =   0.30629316876232D-12
      EOS%IAPWS_VAPOR_COEFF%IR(37) = 20;     EOS%IAPWS_VAPOR_COEFF%JR(37)  =  48;    EOS%IAPWS_VAPOR_COEFF%NR(37) = - 0.42002467698208D-5
      EOS%IAPWS_VAPOR_COEFF%IR(38) = 21;     EOS%IAPWS_VAPOR_COEFF%JR(38)  =  21;    EOS%IAPWS_VAPOR_COEFF%NR(38) = - 0.59056029685639D-25
      EOS%IAPWS_VAPOR_COEFF%IR(39) = 22;     EOS%IAPWS_VAPOR_COEFF%JR(39)  =  53;    EOS%IAPWS_VAPOR_COEFF%NR(39) =   0.37826947613457D-5
      EOS%IAPWS_VAPOR_COEFF%IR(40) = 23;     EOS%IAPWS_VAPOR_COEFF%JR(40)  =  39;    EOS%IAPWS_VAPOR_COEFF%NR(40) = - 0.12768608934681D-14
      EOS%IAPWS_VAPOR_COEFF%IR(41) = 24;     EOS%IAPWS_VAPOR_COEFF%JR(41)  =  26;    EOS%IAPWS_VAPOR_COEFF%NR(41) =   0.73087610595061D-28
      EOS%IAPWS_VAPOR_COEFF%IR(42) = 24;     EOS%IAPWS_VAPOR_COEFF%JR(42)  =  40;    EOS%IAPWS_VAPOR_COEFF%NR(42) =   0.55414715350778D-16
      EOS%IAPWS_VAPOR_COEFF%IR(43) = 24;     EOS%IAPWS_VAPOR_COEFF%JR(43)  =  58;    EOS%IAPWS_VAPOR_COEFF%NR(43) = - 0.94369707241210D-6  
          
      EOS%IAPWS_M_VAPOR_COEFF%IR(1)  =  1;     EOS%IAPWS_M_VAPOR_COEFF%JR(1)  =    0;    EOS%IAPWS_M_VAPOR_COEFF%NR(1)  = - 0.73362260186506D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(2)  =  1;     EOS%IAPWS_M_VAPOR_COEFF%JR(2)  =    2;    EOS%IAPWS_M_VAPOR_COEFF%NR(2)  = - 0.88223831943146D-1
      EOS%IAPWS_M_VAPOR_COEFF%IR(3)  =  1;     EOS%IAPWS_M_VAPOR_COEFF%JR(3)  =    5;    EOS%IAPWS_M_VAPOR_COEFF%NR(3)  = - 0.72334555213245D-1
      EOS%IAPWS_M_VAPOR_COEFF%IR(4)  =  1;     EOS%IAPWS_M_VAPOR_COEFF%JR(4)  =   11;    EOS%IAPWS_M_VAPOR_COEFF%NR(4)  = - 0.40813178534455D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(5)  =  2;     EOS%IAPWS_M_VAPOR_COEFF%JR(5)  =    1;    EOS%IAPWS_M_VAPOR_COEFF%NR(5)  =   0.20097803380207D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(6)  =  2;     EOS%IAPWS_M_VAPOR_COEFF%JR(6)  =    7;    EOS%IAPWS_M_VAPOR_COEFF%NR(6)  = - 0.53045921898642D-1
      EOS%IAPWS_M_VAPOR_COEFF%IR(7)  =  2;     EOS%IAPWS_M_VAPOR_COEFF%JR(7)  =   16;    EOS%IAPWS_M_VAPOR_COEFF%NR(7)  = - 0.76190409086970D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(8)  =  3;     EOS%IAPWS_M_VAPOR_COEFF%JR(8)  =    4;    EOS%IAPWS_M_VAPOR_COEFF%NR(8)  = - 0.63498037657313D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(9)  =  3;     EOS%IAPWS_M_VAPOR_COEFF%JR(9)  =   16;    EOS%IAPWS_M_VAPOR_COEFF%NR(9)  = - 0.86043093028588D-1
      EOS%IAPWS_M_VAPOR_COEFF%IR(10) =  4;     EOS%IAPWS_M_VAPOR_COEFF%JR(10)  =   7;    EOS%IAPWS_M_VAPOR_COEFF%NR(10) =   0.75321581522770D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(11) =  4;     EOS%IAPWS_M_VAPOR_COEFF%JR(11)  =  10;    EOS%IAPWS_M_VAPOR_COEFF%NR(11) = - 0.79238375446139D-2
      EOS%IAPWS_M_VAPOR_COEFF%IR(12) =  5;     EOS%IAPWS_M_VAPOR_COEFF%JR(12)  =   9;    EOS%IAPWS_M_VAPOR_COEFF%NR(12) = - 0.22888160778447D-3
      EOS%IAPWS_M_VAPOR_COEFF%IR(13) =  5;     EOS%IAPWS_M_VAPOR_COEFF%JR(13)  =  10;    EOS%IAPWS_M_VAPOR_COEFF%NR(13) = - 0.26456501482810D-2
     
    END SUBROUTINE SET_IAPWS97
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE SET_SRK_PROPERTY(EOS,FLUID,GAS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(INOUT) :: EOS
      INTEGER, INTENT(IN) :: FLUID,GAS
      TYPE(T_SRK_PROPERTY) :: SRK_PROPERTY
      
      SELECT CASE(FLUID)
      CASE(2) ! NITROGEN
        SRK_PROPERTY%TC  = 126.19D0
        SRK_PROPERTY%PC  = 3.3958D6
        SRK_PROPERTY%TB  = 77.355D0
        SRK_PROPERTY%MW  = 28.013D-3
        SRK_PROPERTY%W   = 0.0372D0
        SRK_PROPERTY%CV0 = 742.2D0 
        
      CASE(3) ! OXYTEN
        SRK_PROPERTY%TC  = 154.58D0
        SRK_PROPERTY%PC  = 5.043D6
        SRK_PROPERTY%TB  = 90.188D0
        SRK_PROPERTY%MW  = 31.999D-3
        SRK_PROPERTY%W   = 0.0222D0
        SRK_PROPERTY%CV0 = 650.D0
          
      CASE(4) ! HYDROGEN
        SRK_PROPERTY%TC  = 33.145D0
        SRK_PROPERTY%PC  = 1.2964D6
        SRK_PROPERTY%TB  = 20.369D0
        SRK_PROPERTY%MW  = 2.0159D-3
        SRK_PROPERTY%W   = -0.219D0
        SRK_PROPERTY%CV0 = 0.D0         ! SHOULD BE FILLED
        
      CASE(5) ! HELIUM
        SRK_PROPERTY%TC  = 5.1953D0
        SRK_PROPERTY%PC  = 0.22746D6
        SRK_PROPERTY%TB  = 4.23D0
        SRK_PROPERTY%MW  = 4.0026D-3
        SRK_PROPERTY%W   = -0.382D0 
        SRK_PROPERTY%CV0 = 0.D0         ! SHOULD BE FILLED
      CASE DEFAULT
      END SELECT

      SELECT CASE(GAS)
      CASE(1)
        EOS%SRK_VAPOR_PROPERTY = SRK_PROPERTY
      CASE(2)
        EOS%SRK_GAS_PROPERTY = SRK_PROPERTY
      CASE DEFAULT
      END SELECT
    END SUBROUTINE SET_SRK_PROPERTY
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE SET_SRK_COEFF(P,T,SRK_PROPERTY,SRK_COEFF)
      IMPLICIT NONE
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_SRK_PROPERTY), INTENT(IN) :: SRK_PROPERTY
      TYPE(T_SRK_COEFF), INTENT(OUT) :: SRK_COEFF
      REAL(8),PARAMETER :: RU=8.314D0

      SRK_COEFF%S     = 0.48508D0 + 1.5517D0*SRK_PROPERTY%W - 0.15613D0*SRK_PROPERTY%W**2
      SRK_COEFF%A     = 0.42747D0*(RU*SRK_PROPERTY%TC)**2/SRK_PROPERTY%PC
      SRK_COEFF%ALPHA = (1.D0 + SRK_COEFF%S*(1.D0-DSQRT(T/SRK_PROPERTY%TC)))**2      
      SRK_COEFF%B     = 0.08664D0*RU*SRK_PROPERTY%TC/SRK_PROPERTY%PC

    END SUBROUTINE SET_SRK_COEFF
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC         
    SUBROUTINE SET_SRK_BINARY(EOS,FLUID,NGAS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(INOUT) :: EOS
      INTEGER, INTENT(IN) :: FLUID, NGAS
      
      ! N2-H2,N2-He,O2-He,H2-He
      ! Binary interaction parameter k_ij for calculating the second cross-virial coefficients of mixtures
      ! Long Meng, Yuan-Yuan Duan, Xiao-Dong Wang 
      ! Above are for virial, actually!!
      
      ! N2-O2
      ! Vapor-Liquid Equilibria of Mixtures Containing N2, O2, CO2, and Ethane.
      ! J.Stoll, J.Vrabec, H.Hasse
      
      ! O2-H2
      ! DO NOT USE THIS COMBINATION
           
      SELECT CASE(NGAS)
      CASE(2) ! NITROGEN
        SELECT CASE(FLUID)
        CASE(2) ! NITROGEN
          EOS%SRK_GAS_PROPERTY%K = 0.D0
        CASE(3) ! OXYGEN
          EOS%SRK_GAS_PROPERTY%K = -0.00978D0 
        CASE(4) ! HYDROGEN 
          EOS%SRK_GAS_PROPERTY%K = 0.037D0
        END SELECT
        
      CASE(3) ! OXYGEN
        SELECT CASE(FLUID)
        CASE(2) ! NITROGEN
          EOS%SRK_GAS_PROPERTY%K = -0.00978D0 
        CASE(3) ! OXYGEN
          EOS%SRK_GAS_PROPERTY%K = 0.D0
        CASE(4) ! HYDROGEN 
          EOS%SRK_GAS_PROPERTY%K = 0.D0
        END SELECT
        
      CASE(4) ! HYDROGEN
        SELECT CASE(FLUID)
        CASE(2) ! NITROGEN
          EOS%SRK_GAS_PROPERTY%K = 0.037D0
        CASE(3) ! OXYGEN
          EOS%SRK_GAS_PROPERTY%K = 0.D0
        CASE(4) ! HYDROGEN 
          EOS%SRK_GAS_PROPERTY%K = 0.D0
        END SELECT
        
      CASE(5) ! HELIUM
        SELECT CASE(FLUID)
        CASE(2) ! NITROGEN
          EOS%SRK_GAS_PROPERTY%K = 0.281D0
        CASE(3) ! OXYGEN
          EOS%SRK_GAS_PROPERTY%K = 0.248D0
        CASE(4) ! HYDROGEN 
          EOS%SRK_GAS_PROPERTY%K = 0.328D0   
        END SELECT
      END SELECT
      
      EOS%SRK_VAPOR_PROPERTY%K = 0.D0
    END SUBROUTINE SET_SRK_BINARY
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC 
    SUBROUTINE SRK_V(EOS,P,T,VAPOR)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
      TYPE(T_SRK_COEFF) :: SRK_COEFF
      REAL(8) :: A,ALPHA,B,MW,S,TC,PC,CV0
      REAL(8) :: RHO,E,H,PV
      REAL(8) :: DPDT,DPDR
      REAL(8) :: DAADT,DSAADT,DAIDT
      REAL(8) :: DDAADDT,DDSAADDT,DDAIDDT
      REAL(8) :: CV,CP,BP,BT
      REAL(8),PARAMETER :: RU=8.314D0
      
      CALL SET_SRK_COEFF(P,T,EOS%SRK_VAPOR_PROPERTY,SRK_COEFF)
            
      A     = SRK_COEFF%A
      ALPHA = SRK_COEFF%ALPHA
      B     = SRK_COEFF%B
      MW    = EOS%SRK_VAPOR_PROPERTY%MW 
      S     = SRK_COEFF%S
      TC    = EOS%SRK_VAPOR_PROPERTY%TC
      PC    = EOS%SRK_VAPOR_PROPERTY%PC
      CV0   = EOS%SRK_VAPOR_PROPERTY%CV0
      
      PV = COMPUTEPV(TC,PC,EOS%SRK_VAPOR_PROPERTY%TB,T)
      !IF ((P.LE.PV).AND.(T.LE.TC)) THEN
      IF ((P.LE.PV)) THEN
        ALPHA = PV/PC
      END IF
      
      RHO = CUBICSOLVER(P,T,A*ALPHA,B,MW)
      
      ! FIND DAADT FOR DPDT
      DAIDT  = -S/DSQRT(T*TC)*(1.D0+S*(1.D0-DSQRT(T/TC)))
      DSAADT = DAIDT
      DAADT  = A*DSAADT
      
      ! DPDT, DPDR
      DPDT = RHO*RU/(MW-B*RHO) - DAADT*RHO**2/(MW*(MW+B*RHO))
      DPDR = MW*RU*T/(MW-B*RHO)**2 - A*ALPHA*RHO*(2.D0*MW+B*RHO)/(MW*(MW+B*RHO)**2)
      
      ! FIND DDAADDT FOR CV
      DDAIDDT  = 0.5D0*S* (S/(T*TC) + (1.D0+S*(1.D0-DSQRT(T/TC)))/DSQRT(T**3*TC))
      DDSAADDT = DDAIDDT
      DDAADDT  = A*DDSAADDT
      
      ! CV FOR DHDT & E
      CV = CV0 + T*DDAADDT*DLOG(1.D0+B*RHO/MW)/(B*MW)
      CP = CV + T*DPDT**2/(RHO**2*DPDR)
      
      ! DHDP, DHDT
      BP = 1.D0/RHO - P/(RHO**2*DPDR)
      BT = CV + DPDT*P/(RHO**2*DPDR)

      E = CV0*T + (T*DAADT-A*ALPHA)*DLOG(1.D0+B*RHO/MW)/(B*MW)
      H = E + DPDR*(1.D0-RHO*BP)       
      
      VAPOR%RHO  = RHO
      VAPOR%H    = H
      VAPOR%DRDP = 1.D0/DPDR
      VAPOR%DRDT = -DPDT/DPDR
      VAPOR%DHDP = BP
      VAPOR%DHDT = CP
      VAPOR%CV   = CV
      
    END SUBROUTINE SRK_V
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE SRK_G(EOS,P,T,GAS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: GAS
      TYPE(T_SRK_COEFF) :: SRK_COEFF
      REAL(8),PARAMETER :: RU=8.314D0
      REAL(8) :: A,ALPHA,B,MW,S,TC,PC,CV0
      REAL(8) :: RHO,E,H,PV
      REAL(8) :: DPDT,DPDR
      REAL(8) :: DAADT,DSAADT,DAIDT
      REAL(8) :: DDAADDT,DDSAADDT,DDAIDDT
      REAL(8) :: CV,CP,BP,BT,AP,AR
      
      CALL SET_SRK_COEFF(P,T,EOS%SRK_GAS_PROPERTY,SRK_COEFF)
            
      A     = SRK_COEFF%A
      ALPHA = SRK_COEFF%ALPHA
      B     = SRK_COEFF%B
      MW    = EOS%SRK_GAS_PROPERTY%MW 
      S     = SRK_COEFF%S
      TC    = EOS%SRK_GAS_PROPERTY%TC
      PC    = EOS%SRK_GAS_PROPERTY%PC
      CV0   = EOS%SRK_GAS_PROPERTY%CV0
      
      PV = COMPUTEPV(TC,PC,EOS%SRK_GAS_PROPERTY%TB,T)
      !IF ((P.LE.PV).AND.(T.LE.TC)) THEN
      IF ((P.LE.PV)) THEN
        ALPHA = PV/PC
      END IF
      
      RHO = CUBICSOLVER(P,T,A*ALPHA,B,MW)
      
      ! FIND DAADT FOR DPDT
      DAIDT  = -S/DSQRT(T*TC)*(1.D0+S*(1.D0-DSQRT(T/TC)))
      DSAADT = DAIDT
      DAADT  = A*DSAADT
      
      ! DPDT, DPDR
      DPDT = RHO*RU/(MW-B*RHO) - DAADT*RHO**2/(MW*(MW+B*RHO))
      DPDR = MW*RU*T/(MW-B*RHO)**2 - A*ALPHA*RHO*(2.D0*MW+B*RHO)/(MW*(MW+B*RHO)**2)
      
      ! FIND DDAADDT FOR CV
      DDAIDDT  = 0.5D0*S* (S/(T*TC) + (1.D0+S*(1.D0-DSQRT(T/TC)))/DSQRT(T**3*TC))
      DDSAADDT = DDAIDDT
      DDAADDT  = A*DDSAADDT
      
      ! CV FOR DHDT & E
      CV = CV0 + T*DDAADDT*DLOG(1.D0+B*RHO/MW)/(B*MW)
      CP = CV + T*DPDT**2/(RHO**2*DPDR)

      ! DHDP, DHDT
      BP = 1.D0/RHO - P/(RHO**2*DPDR)
      BT = CV + DPDT*P/(RHO**2*DPDR)

      AP = CV/DPDT+1.D0/RHO 
      AR = -CV/DPDT*DPDR - P/RHO**2
      
      E = CV0*T + (T*DAADT-A*ALPHA)*DLOG(1.D0+B*RHO/MW)/(B*MW)
      H = E + DPDR*(1.D0-RHO*BP)
      
      GAS%RHO  = RHO
      GAS%H    = H
      GAS%DRDP = 1.D0/DPDR
      GAS%DRDT = -DPDT/DPDR
      GAS%DHDP = BP
      GAS%DHDT = CP
      GAS%CV   = CV
        
    END SUBROUTINE SRK_G
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC         
    SUBROUTINE SRK_M(EOS,P,T,Y1,Y2,ULLAGE)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T,Y1,Y2
      TYPE(T_EOS2), INTENT(OUT) :: ULLAGE
      TYPE(T_SRK_COEFF) :: SRK_GAS_COEFF,SRK_VAPOR_COEFF
      REAL(8),PARAMETER :: RU=8.314D0
      REAL(8) :: AI,ALPHAI,BI,MWI,SI,TCI,PCI,CV0I,XI
      REAL(8) :: AJ,ALPHAJ,BJ,MWJ,SJ,TCJ,PCJ,CV0J,XJ,KIJ
      REAL(8) :: ALPHAAIJ,AALPHA,B,MW,CV0
      REAL(8) :: RHO,E,H,PV
      REAL(8) :: DPDT,DPDR
      REAL(8) :: DAADT,DSAADT,DAIDT,DAJDT
      REAL(8) :: DDAADDT,DDSAADDT,DDAIDDT,DDAJDDT
      REAL(8) :: DAAIJDT,E_P_DEN_I,E_P_DEN_J,H_P_MASS_I,H_P_MASS_J,H_P_DEN_I,H_P_DEN_J,DPDRI,DPDRJ
      REAL(8) :: CV,CP,BP,BT
      
      ! GET COEFFICIENTS OF EACH CONSTITUENT GAS
      CALL SET_SRK_COEFF(P,T,EOS%SRK_GAS_PROPERTY,SRK_GAS_COEFF)
      CALL SET_SRK_COEFF(P,T,EOS%SRK_VAPOR_PROPERTY,SRK_VAPOR_COEFF)

      AI     = SRK_VAPOR_COEFF%A
      ALPHAI = SRK_VAPOR_COEFF%ALPHA
      BI     = SRK_VAPOR_COEFF%B
      MWI    = EOS%SRK_VAPOR_PROPERTY%MW 
      SI     = SRK_VAPOR_COEFF%S
      TCI    = EOS%SRK_VAPOR_PROPERTY%TC
      PCI    = EOS%SRK_VAPOR_PROPERTY%PC
      CV0I   = EOS%SRK_VAPOR_PROPERTY%CV0
      
      AJ     = SRK_GAS_COEFF%A
      ALPHAJ = SRK_GAS_COEFF%ALPHA
      BJ     = SRK_GAS_COEFF%B
      MWJ    = EOS%SRK_GAS_PROPERTY%MW 
      SJ     = SRK_GAS_COEFF%S
      TCJ    = EOS%SRK_GAS_PROPERTY%TC
      PCJ    = EOS%SRK_GAS_PROPERTY%PC
      CV0J   = EOS%SRK_GAS_PROPERTY%CV0

      KIJ    = EOS%SRK_GAS_PROPERTY%K
  
      PV = COMPUTEPV(TCI,PCI,EOS%SRK_VAPOR_PROPERTY%TB,T)
      !IF ((P.LE.PV).AND.(T.LE.TCI)) THEN
      IF ((P.LE.PV)) THEN
        ALPHAI = PV/PCI
      END IF
      
      PV = COMPUTEPV(TCJ,PCJ,EOS%SRK_GAS_PROPERTY%TB,T)
      !IF ((P.LE.PV).AND.(T.LE.TCJ)) THEN
      IF ((P.LE.PV)) THEN
        ALPHAJ = PV/PCJ
      END IF
      
      ! CALCULATE MOLE FRACTION
      MW = (Y1+Y2)/(Y1/MWI + Y2/MWJ)
      XI = Y1*MW/(MWI*(Y1+Y2))
      XJ = Y2*MW/(MWJ*(Y1+Y2))
      
      ! FIND MIXTURE PROPERTY
      ALPHAAIJ = DSQRT(ALPHAI*ALPHAJ*AI*AJ)*(1.D0-KIJ)
      AALPHA   = XI**2*ALPHAI*AI + 2.D0*XI*XJ*ALPHAAIJ + XJ**2*ALPHAJ*AJ
      B        = XI*BI + XJ*BJ
      CV0      = XI*CV0I + XJ*CV0J

      RHO = CUBICSOLVER(P,T,AALPHA,B,MW)
      
      ! FIND DAADT FOR DPDT
      DAIDT  = -SI/DSQRT(T*TCI)*(1.D0+SI*(1.D0-DSQRT(T/TCI)))
      DAJDT  = -SJ/DSQRT(T*TCJ)*(1.D0+SJ*(1.D0-DSQRT(T/TCJ))) 
      DSAADT = 0.5D0*(DSQRT(ALPHAI/ALPHAJ)*DAJDT + DSQRT(ALPHAJ/ALPHAI)*DAIDT)
      DAADT  = XI**2*AI*DAIDT + 2.D0*XI*XJ*DSQRT(AI*AJ)*DSAADT + XJ**2*AJ*DAJDT
      
      ! DPDT, DPDR
      DPDT = RHO*RU/(MW-B*RHO) - DAADT*RHO**2/(MW*(MW+B*RHO))
      DPDR = MW*RU*T/(MW-B*RHO)**2 - AALPHA*RHO*(2.D0*MW+B*RHO)/(MW*(MW+B*RHO)**2)
      DPDRI = MW*RU*T/(MWI*(MW-B*RHO)**2)*(MW+RHO*(BI-B)) &
              - 2.D0*RHO*XJ*ALPHAAIJ/(MWI*(MW+B*RHO)) &
              + AALPHA*RHO**2*BI/(MWI*(MW+B*RHO)**2)
      DPDRJ = MW*RU*T/(MWJ*(MW-B*RHO)**2)*(MW+RHO*(BJ-B)) &
              - 2.D0*RHO*XI*ALPHAAIJ/(MWJ*(MW+B*RHO)) &
              + AALPHA*RHO**2*BJ/(MWJ*(MW+B*RHO)**2)
      
      ! FIND DDAADDT FOR CV
      DDAIDDT  = 0.5D0*SI * (SI/(T*TCI) + (1.D0+SI*(1.D0-DSQRT(T/TCI)))/DSQRT(T**3*TCI))
      DDAJDDT  = 0.5D0*SJ * (SJ/(T*TCJ) + (1.D0+SJ*(1.D0-DSQRT(T/TCJ)))/DSQRT(T**3*TCJ))
      DDSAADDT = 0.5D0 * (DAIDT*DAJDT/DSQRT(ALPHAI*ALPHAJ)                &
                         - 0.5D0*DSQRT(ALPHAI/ALPHAJ**3)*DAJDT**2         &
                         - 0.5D0*DSQRT(ALPHAJ/ALPHAI**3)*DAIDT**2         &
                         + DSQRT(ALPHAI/ALPHAJ)*DDAJDDT                   &
                         + DSQRT(ALPHAJ/ALPHAI)*DDAIDDT )
      DDAADDT  = XI**2*AI*DDAIDDT + 2.D0*XI*XJ*DSQRT(AI*AJ)*DDSAADDT + XJ**2*AJ*DDAJDDT
      
      ! CV FOR DHDT & E
      CV = CV0 + T*DDAADDT*DLOG(1.D0+B*RHO/MW)/(B*MW)
      CP = CV + T*DPDT**2/(RHO**2*DPDR)
      
      ! DHDP, DHDT
      BP = 1.D0/RHO - P/(RHO**2*DPDR)
      BT = CV + DPDT*P/(RHO**2*DPDR)

      ! DAAIJDT FOR PARTIAL DENSITY ENERGY(E_P_DEN)
      DAAIJDT = DSQRT(AI*AJ)*DSAADT
      
      ! E_P_DEN, H_P_DEN, H_P_MASS
      E_P_DEN_I = CV0I*T + ( 2.D0*(XJ*(T*DAAIJDT-ALPHAAIJ))*DLOG(1.D0+B*RHO/MW) &
                           + BI*(T*DAADT-AALPHA)*(RHO/(MW+B*RHO)-DLOG(1.D0+B*RHO/MW)/B) ) / (B*MWI)
      E_P_DEN_J = CV0J*T + ( 2.D0*(XI*(T*DAAIJDT-ALPHAAIJ))*DLOG(1.D0+B*RHO/MW) &
                           + BJ*(T*DAADT-AALPHA)*(RHO/(MW+B*RHO)-DLOG(1.D0+B*RHO/MW)/B) ) / (B*MWJ)  
      H_P_DEN_I = E_P_DEN_I + DPDRI
      H_P_DEN_J = E_P_DEN_J + DPDRJ
      H_P_MASS_I = E_P_DEN_I + DPDRI*(1.D0-RHO*BP)
      H_P_MASS_J = E_P_DEN_J + DPDRJ*(1.D0-RHO*BP)
      
      E = CV0*T + (T*DAADT-AALPHA)*DLOG(1.D0+B*RHO/MW)/(B*MW)
      H = E + DPDR*(1.D0-RHO*BP)       
            
      ULLAGE%RHO  = RHO
      ULLAGE%H    = H
      ULLAGE%DRDP = 1.D0/DPDR
      ULLAGE%DRDT = -DPDT/DPDR
      ULLAGE%DHDP = BP
      ULLAGE%DHDT = CP
      ULLAGE%CV   = CV
      
    END SUBROUTINE SRK_M   
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC      
    SUBROUTINE IDEAL(EOS,P,T,GAS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: GAS
      REAL(8), PARAMETER :: R1 = 1.4D0/0.4D0/1004.64
      REAL(8) :: TAU
      
      TAU = 1.D0/T
      
      GAS%RHO  = P*R1*TAU
      GAS%H    = 1004.64D0*T
      GAS%DRDP = R1*TAU
      GAS%DRDT = -P*R1*TAU**2
      GAS%DHDP = 0.D0
      GAS%DHDT = 1004.64D0
      
    END SUBROUTINE IDEAL
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE H2O_L_FIT(EOS,P,T,LIQUID)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID
      
      LIQUID%RHO = - 6311.024687022091D0+105.96719226625858D0*T-0.6180387750363456D0*T**2+0.0018192120809256687D0*T**3- &
                 2.7046566485973865D-6*T**4 + 1.61722220645795D-9*T**5 + 0.000029080581316291686D0*P -                  &
                 3.3309022145970827D-7*T*P +1.4640381037355473D-9*T**2*P -                                              &
                 2.8865979129253496D-12*T**3*P + 2.156808271941056D-15*T**4*P -                                         &
                 2.6280680541055985D-14*P**2 + 2.297216572824232D-16*T*P**2 -                                           &
                 6.747504264295466D-19*T**2*P**2 + 6.525442466633386D-22*T**3*P**2
                 
      LIQUID%H = 1.3557612872909496D9 - 1.363266289856961D7*T + 40681.30627818539D0*T**2 - 41.77799452978375D0*T**3 +                          &
               0.016078938509377864D0*T**4 - 1.6731139882275142D-6*T**5 - 3.2351874957958134D6*LIQUID%RHO + 31394.61628884811D0*T*LIQUID%RHO - &
               83.9426871170273D0*T**2*LIQUID%RHO + 0.06306446061998854D0*T**3*LIQUID%RHO - 0.000013263064759017577D0*T**4*LIQUID%RHO +        &
               2553.4878230058544D0*LIQUID%RHO**2 - 23.88678218373101D0*T*LIQUID%RHO**2 + 0.055714123710032606D0*T**2*LIQUID%RHO**2 -          &
               0.000023226414329920397D0*T**3*LIQUID%RHO**2 - 0.6662015780399999D0*LIQUID%RHO**3 + 0.006005285813282444D0*T*LIQUID%RHO**3 -    &
               0.000011766537107697452D0*T**2*LIQUID%RHO**3
      LIQUID%DRDP = 0.028344984598699954D0 - 0.0002652384870719236D0*T + 8.069978640361292D-7*T**2 -                                        &
                  8.975533323360278D-10*T**3 + 4.2088568723050893D-13*T**4 - 7.187943097341636D-17*T**5 -                                   &
                  0.00006936637304995329D0*LIQUID%RHO + 6.119809907043226D-7*T*LIQUID%RHO - 1.6429994317814744D-9*T**2*LIQUID%RHO +         &
                  1.2949079244023172D-12*T**3*LIQUID%RHO - 3.117135505170058D-16*T**4*LIQUID%RHO + 5.665107930759331D-8*LIQUID%RHO**2 -     &
                  4.69641704021055D-10*T*LIQUID%RHO**2+1.0885462450668403D-12*T**2*LIQUID%RHO**2-4.63961788687922D-16*T**3*LIQUID%RHO**2 -  &
                  1.543349645193048D-11*LIQUID%RHO**3 + 1.1974984976879823D-13*T*LIQUID%RHO**3 - 2.3212446257875464D-16*T**2*LIQUID%RHO**3
      LIQUID%DRDT = 121879.9584706434D0-1139.2925141420403D0*T+3.4530261160544415D0*T**2 - 0.003775156632058203D0*T**3+                    &
                  1.712735110674499D-6*T**4 - 2.7555948221273537D-10*T**5 - 299.6006492602664D0*LIQUID%RHO +                               &
                  2.646621331302561D0*T*LIQUID%RHO -0.007107401898351704D0*T**2*LIQUID%RHO + 5.532737555143375D-6*T**3*LIQUID%RHO -        &
                  1.300382894492162D-9*T**4*LIQUID%RHO + 0.24544365927014916D0*LIQUID%RHO**2 - 0.002041380849491402D0*T*LIQUID%RHO**2 +    &
                  4.7506749483188065D-6*T**2*LIQUID%RHO**2 - 2.0054026031199562D-9*T**3*LIQUID%RHO**2 -                                    &
                  0.00006702275389171266D0*LIQUID%RHO**3 + 5.22658483578724D-7*T*LIQUID%RHO**3 - 1.021429064669065D-9*T**2*LIQUID%RHO**3
      LIQUID%DHDP = 28.256990502588454D0 - 0.258386234711587D0*T + 0.0007698968883972372D0*T**2 -                                         &
                  8.299018578366212D-7*T**3 + 3.7225797441168453D-10*T**4 - 5.932327720843982D-14*T**5 -                                  &
                  0.0699434126351822D0*LIQUID%RHO +  0.0006037175382305189D0*T*LIQUID%RHO - 1.5925877833800108D-6*T**2*LIQUID%RHO +       &
                  1.2213368187673786D-9*T**3*LIQUID%RHO - 2.836880571012265D-13*T**4*LIQUID%RHO + 0.00005771616450097861D0*LIQUID%RHO**2- &
                  4.6843157322323967D-7*T*LIQUID%RHO**2 + 1.0699805810683837D-9*T**2*LIQUID%RHO**2 -                                      &
                  4.445120270945741D-13*T**3*LIQUID%RHO**2 - 1.588026958029046D-8*LIQUID%RHO**3 +                                         &
                  1.2067728903792023D-10*T*LIQUID%RHO**3 - 2.313101693533085D-13*T**2*LIQUID%RHO**3                      
      LIQUID%DHDT = 2.418822477923761D7+35108.447996488154D0*T - 873.5689347951068D0*T**2 + 1.7230272675151386D0*T**3-                &
                  0.0010893940589922265D0*T**4 + 2.177699794807627D-7*T**5 - 81178.10072386597D0*LIQUID%RHO +                         &
                  90.42654563938547D0*T*LIQUID%RHO + 1.4007102727849796D0*T**2*LIQUID%RHO - 0.0022661796428748962D0*T**3*LIQUID%RHO + &
                  7.777074422878771D-7*T**4*LIQUID%RHO + 85.17031674149585D0*LIQUID%RHO**2 - 0.20952117580112675D0*T*LIQUID%RHO**2 -  &
                  0.000655595931910761D0*T**2*LIQUID%RHO**2 + 7.213406726853327D-7*T**3*LIQUID%RHO**2 -                               &
                  0.028586662251862786D0*LIQUID%RHO**3 + 0.00009122145304724242D0*T*LIQUID%RHO**3 +                                   &
                  7.761232305034003D-8*T**2*LIQUID%RHO**3  
    END SUBROUTINE H2O_L_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE H2O_V_FIT(EOS,P,T,VAPOR)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
      
      IF(T.LE.347.D0) THEN
        VAPOR%RHO = 0.0046086722990453105D0 - 0.00004151388632156331D0*T + 1.2413429087175857D-7*T**2 - 1.2306907168991188D-10*T**3 &
                  + 0.000020178322982098646D0*P - 6.247722798143032D-8*T*P                                                          &
                  + 6.431744010624924D-11*T**2*P+ 1.18294435757289D-11*P**2                                                         &
                  - 3.0114803183388726D-14*T*P**2
        VAPOR%H = 1.6140385439321147D6 + 8052.693799326647D0*T - 40.01547777953337D0*T**2 + 0.1282203670472617D0*T**3 -                       &
                0.00020429579076161367D0*T**4 + 1.2999110502072536D-7*T**5 - 4.6229047884475544D7*VAPOR%RHO + 556220.6222673394D0*T*VAPOR%RHO &  
                -2518.9396226736376D0*T**2*VAPOR%RHO + 5.080373140251466D0*T**3*VAPOR%RHO - 0.0038468216423550375D0*T**4*VAPOR%RHO -          &
                1.4102180069315466D8*VAPOR%RHO**2 + 1.260420439726543D6*T*VAPOR%RHO**2 - 3753.392034834953D0*T**2*VAPOR%RHO**2 +              &
                3.7239906172249513D0*T**3*VAPOR%RHO**2 - 5.175977413572329D7*VAPOR%RHO**3 + 300383.7348311928D0*T*VAPOR%RHO**3 -              &
                435.84557503111483D0*T**2*VAPOR%RHO**3
        VAPOR%DRDP = 0.000052009410802462945D0 - 5.004533737095439D-7*T + 2.496157019891614D-9*T**2 -                                         &
                        6.850414374885032D-12*T**3 + 9.850424673683412D-15*T**4 - 5.81580779044606D-18*T**5 +                                 &
                        0.0007468297964490092D0*VAPOR%RHO - 8.945009619536416D-6*T*VAPOR%RHO + 4.035865049281818D-8*T**2*VAPOR%RHO -          &
                        8.11581415175705D-11*T**3*VAPOR%RHO + 6.131099812799595D-14*T**4*VAPOR%RHO +  0.0018361131184468887D0*VAPOR%RHO**2 -  &
                        0.000016425813360828023D0*T*VAPOR%RHO**2 + 4.896642737873156D-8*T**2*VAPOR%RHO**2 -                                   &
                        4.864021269344103D-11*T**3*VAPOR%RHO**2 + 0.0006498859974798217D0*VAPOR%RHO**3 -                                      &
                        3.7770305631556957D-6*T*VAPOR%RHO**3 + 5.488322941633847D-9*T**2*VAPOR%RHO**3
        VAPOR%DHDT = 69740.2862537548D0 - 1106.8606451381106D0*T + 7.173138161430398D0*T**2 -                                                 &
                    0.023112000968498456D0*T**3 + 0.00003704343835272604D0*T**4 - 2.3632785520084313D-8*T**5 +                                &
                    7.06467480366046D6*VAPOR%RHO - 86531.28933536631D0*T*VAPOR%RHO + 397.27353974813946D0*T**2*VAPOR%RHO -                    &
                    0.8100829096462536D0*T**3*VAPOR%RHO + 0.0006189421808640733D0*T**4*VAPOR%RHO + 2.4331535736487016D7*VAPOR%RHO**2 -        &
                    217697.33317293136D0*T*VAPOR%RHO**2 + 648.8848821623319D0*T**2*VAPOR%RHO**2 -                                             &
                    0.6443472958123013D0*T**3*VAPOR%RHO**2 + 8.957917762373075D6*VAPOR%RHO**3 -                                               &
                    52014.21123588152D0*T*VAPOR%RHO**3 + 75.50955185252435D0*T**2*VAPOR%RHO**3 
      ELSE IF((T.GT.347.D0).AND.(T.LE.497.D0)) THEN
        VAPOR%RHO = 0.0304345716654541D0 -0.000217065175507298D0*T + 5.17227679271671D-07*T**2 - 4.07615934825363D-10*T**3 +        &
                    0.0000206853043135603D0*P - 7.37792204298515D-08*T*P                                                            &
                    + 1.16426003692796D-10*T**2*P - 6.85486255365125D-14*T**3*P                                                     &
                    + 3.02040748441321D-11*P**2 - 1.78331822460195D-13*T*P**2                                                       &
                    + 3.57437719439424D-16*T**2*P**2 - 2.41822055967549D-19*T**3*P**2                                               &
                    +5.17216589243678D-18*P**3 - 2.10471393810734D-20*T*P**3                                                        &
                    +2.15338023622516D-23*T**2*P**3 + 1.97005590122501D-25*P**4 -                                                   &
                    4.05774798589835D-28*T*P**4 + 2.12852285936374D-33*P**5
        VAPOR%H = 1672315.67433477D0 + 4955.3297331043D0*T - 11.1328027215681D0*T**2 + 0.0175990883625111D0*T**3 - &
                  0.0000101449179466104D0*T**4 - 574582.768022701D0*VAPOR%RHO + 3426.70214256579D0*T*VAPOR%RHO - 7.02840680468889D0*T**2*VAPOR%RHO + &
                  0.00487707943643386D0*T**3*VAPOR%RHO - 21816.9278267704D0*VAPOR%RHO**2 + 89.2301619577232D0*T*VAPOR%RHO**2 -&
                  0.0915244176282538D0*T**2*VAPOR%RHO**2 - 124.509070972886D0*VAPOR%RHO**3 + 0.248625694075255D0*T*VAPOR%RHO**3
        VAPOR%DRDP = 0.0000214068495783794D0 - 7.89132492686781D-08*T + 1.28600002435269D-10*T**2 - 7.81509720014333D-14*T**3 +        &
                     9.70273812432014D-06*VAPOR%RHO - 5.78351768072687D-08*T*VAPOR%RHO + 1.17602375083603D-10*T**2*VAPOR%RHO -                        &
                     8.08411915570631D-14*T**3*VAPOR%RHO + 5.40779755406623D-07*VAPOR%RHO**2 - 2.21646856027985D-09*T*VAPOR%RHO**2 +                  &
                     2.2828969468728D-12*T**2*VAPOR%RHO**2 + 4.99113366855691D-09*VAPOR%RHO**3 - 1.02123051912891D-11*T*VAPOR%RHO**3 +                &
                     9.44914641203704D-12*VAPOR%RHO**4
        VAPOR%DHDT = -3033.80716978799D0 + 45.3409779082821D0*T - 0.157465860914466D0*T**2 + 0.000243173696121016D0*T**3 -            &
                     1.39392770211301D-07*T**4 + 98937.3024214889D0*VAPOR%RHO - 891.054167343861D0*T*VAPOR%RHO + 3.02076705048526D0*T**2*VAPOR%RHO -&
                     0.00455702585759261D0*T**3*VAPOR%RHO + 2.57741825292208D-06*T**4*VAPOR%RHO + 15936.2394936362D0*VAPOR%RHO**2 -                 &
                     104.969845431369D0*T*VAPOR%RHO**2 + 0.230176196829332D0*T**2*VAPOR%RHO**2 - 0.000167962640251061D0*T**3*VAPOR%RHO**2 +         &
                     479.361786337656D0*VAPOR%RHO**3 - 2.03444799195589D0*T*VAPOR%RHO**3 + 0.00215388853083512D0*T**2*VAPOR%RHO**3 +                &
                     2.99492096741046D0*VAPOR%RHO** 4 - 0.00609386126945215D0*T*VAPOR%RHO**4 + 0.00214502154063786D0*VAPOR%RHO**5
      ELSE
        VAPOR%RHO = 13.197225283259D0 - 0.0781811172267488D0*T + 0.000154184911560128D0*T**2 - 1.01228091394607D-07*T**3 -          &
                    0.0000425337828013887D0*P + 3.04665239562157D-07*T*P                                                            &
                    - 6.38086984502479D-10*T**2*P + 4.32474213995152D-13*T**3*P                                                     &
                    + 4.73157952125924D-11*P**2 - 2.78968106119848D-13*T*P**2                                                       &
                    + 5.52729713074471D-16*T**2*P**2 - 3.66680108954259D-19*T**3*P**2                                               &
                    + 3.76386771510989D-18*P**3 - 1.45063542714493D-20*T*P**3                                                       &
                    + 1.40177910612357D-23*T**2*P**3 + 7.82536215892866D-26 *P**4                                                   &
                    - 1.49391037531458D-28*T*P**4   + 4.57130226214232D-34*P**5
        VAPOR%H = 7139235.2818126D0 - 39461.1047270727D0*T + 123.016364051649D0*T**2 - 0.161216479038991D0*T**3 +                       &
                  0.0000787398895903491D0*T**4 - 2133191.8212778D0*VAPOR%RHO + 16504.5657953198D0*T*VAPOR%RHO - 48.4107131761524D0*T**2*VAPOR%RHO +    &
                  0.0634070302544731D0*T**3*VAPOR%RHO - 0.0000312157773910099D0*T**4*VAPOR%RHO - 54671.1142939832D0*VAPOR%RHO**2 +                     &
                  312.54941433458D0*T*VAPOR%RHO**2 - 0.597723026381932D0*T**2*VAPOR%RHO**2 + 0.000381926351635443D0*T**3*VAPOR%RHO**2 -                &
                  301.061606537303D0*VAPOR%RHO**3 + 1.15970794808449D0*T*VAPOR%RHO**3 - 0.00111190863641621D0*T**2*VAPOR%RHO**3 -                      &
                  0.651906676977929D0*VAPOR%RHO**4 + 0.00118075876509709D0*T*VAPOR%RHO**4
        VAPOR%DRDP = 0.000027646722992399D0 - 1.11926434493766D-07*T + 1.85279270247462D-10*T**2 - 1.09363229043887D-13*T**3 -          &
                     0.0000070118253298229D0*VAPOR%RHO + 4.41078803695323D-08*T*VAPOR%RHO - 8.99397396544076D-11*T**2*VAPOR%RHO +                      &
                     6.02028263785701D-14*T**3*VAPOR%RHO + 1.60429170974966D-06*VAPOR%RHO**2 - 9.31573281384837D-09*T*VAPOR%RHO**2 +                   &
                     1.80830036391113D-11*T**2*VAPOR%RHO**2 - 1.17202189573276D-14*T**3*VAPOR%RHO**2 + 1.57622617451259D-08*VAPOR%RHO**3 -             &
                     5.99883628772789D-11*T*VAPOR%RHO**3 + 5.70918830851557D-14*T**2*VAPOR%RHO**3 + 4.1341541526741D-11*VAPOR%RHO**4 -                 &
                     7.71586993101989D-14*T*VAPOR%RHO**4 + 2.58357488221122D-14*VAPOR%RHO**5
        VAPOR%DHDT = 54122.0046918165D0 - 302.437279261426D0*T + 0.582869886344912D0*T**2 - 0.000373348944239481D0*T**3 -             &
                     38696.5616301691D0*VAPOR%RHO + 227.607080757579D0*T*VAPOR%RHO - 0.444233634160479D0*T**2*VAPOR%RHO +                            &
                     0.000288112945516371D0*T**3*VAPOR%RHO + 5420.14763683506D0*VAPOR%RHO**2 - 31.902217596953D0*T*VAPOR%RHO**2 +                    &
                     0.0625549751764669D0*T**2*VAPOR%RHO**2 - 0.0000408485848158127D0*T**3*VAPOR%RHO**2 + 49.0212719421652D0*VAPOR%RHO**3 -          &
                     0.187189705044773D0*T*VAPOR%RHO**3 + 0.000178485823529128D0*T**2*VAPOR%RHO**3 + 0.110318082427605D0*VAPOR%RHO**4 -              &
                     0.00020498071909394D0*T*VAPOR%RHO**4 + 0.0000507096802350709D0*VAPOR%RHO**5
      END IF
      IF (T.LT.296.D0) THEN                
        VAPOR%DRDT = 0.0015480993389557069D0 - 0.00002204315012405441D0*T + 1.1761132674188987D-7*T**2 - 2.786961066751213D-10*T**3     &
                + 2.474814735018812D-13*T**4 - 0.8001981115028577D0*VAPOR%RHO + 0.011427865347741394D0*T*VAPOR%RHO                           &
                - 0.00006157522268531719D0*T**2*VAPOR%RHO + 1.475339596758024D-7*T**3*VAPOR%RHO - 1.3248641132424813D-10*T**4*VAPOR%RHO           &
                - 18.823422434851317D0*VAPOR%RHO**2 + 0.19747534922119145D0*T*VAPOR%RHO**2 - 0.0006904434493780153D0*T**2*VAPOR%RHO**2            &
                + 8.044532992903289D-7*T**3*VAPOR%RHO**2 - 94.28088325558488D0*VAPOR%RHO**3 + 0.6459714529858793D0*T*VAPOR%RHO**3                 &
                - 0.001106113187641709D0*T**2*VAPOR%RHO**3 - 99.90491610726272D0*VAPOR%RHO**4 + 0.33224232928388087D0*T*VAPOR%RHO**4              &
                + 12.558583095426068D0*VAPOR%RHO**5
        VAPOR%DHDP = -42948.92139971102D0 + 774.1474629248053D0*T - 5.574937750585217D0*T**2 +                                        &
                    0.020049561101358117D0*T**3 - 0.00003601017265315555D0*T**4 + 2.5840711650456145D-8*T**5 -                     &
                    3.8795311376638315D6*VAPOR%RHO + 53841.27611225954D0*T*VAPOR%RHO - 280.16500438649547D0*T**2*VAPOR%RHO +                      &
                    0.647830494592685D0*T**3*VAPOR%RHO - 0.0005616580339274063D0*T**4*VAPOR%RHO - 2.529432983615679D7*VAPOR%RHO**2+               &
                    257585.75930428825D0*T*VAPOR%RHO**2 - 874.587299851378D0*T**2*VAPOR%RHO**2 +                                             &
                    0.9900592360302818D0*T**3*VAPOR%RHO**2     
        
      ELSE IF((T.GE.296.D0).AND.(T.LT.314.D0)) THEN
        VAPOR%DRDT = 0.00045711848406281485 - 6.574332974047608D-6*T + 3.517329163462288D-8*T**2 - 8.306194636795476D-11*T**3 +         &
                7.31206542355063D-14*T**4 - 0.27583036049813975D0*VAPOR%RHO + 0.003717655093135968D0*T*VAPOR%RHO -                           &
                0.000019128186158450722D0*T**2*VAPOR%RHO + 4.384516304283248D-8*T**3*VAPOR%RHO - 3.766467591730544D-11*T**4*VAPOR%RHO -           &
                4.775668651062799D0*VAPOR%RHO**2 + 0.04712225492912923D0*T*VAPOR%RHO**2 - 0.00015503387171534767D0*T**2*VAPOR%RHO**2 +            &
                1.7003113271227604D-7*T**3*VAPOR%RHO**2 - 10.931939154387278D0*VAPOR%RHO**3 + 0.07047793818002629D0*T*VAPOR%RHO**3 -              &
                0.00011358413099484183D0*T**2*VAPOR%RHO**3 - 4.537303275769487D0*VAPOR%RHO**4 + 0.014330905251429124D0*T*VAPOR%RHO**4 -           &
                0.02782522311180477D0*VAPOR%RHO**5
      ELSE IF((T.GE.314.D0).AND.(T.LT.332.D0)) THEN
        VAPOR%DRDT = 0.002479474833613407D0 - 0.00003187828249623505D0*T + 1.5348441095810086D-7*T**2 - 3.2801531309942245D-10*T**3     &
                + 2.62559269178044D-13*T**4 - 0.2941904846101775D0*VAPOR%RHO + 0.0037224237724600763D0*T*VAPOR%RHO                           &
                - 0.000017955519612122393D0*T**2*VAPOR%RHO + 3.860049618527247D-8*T**3*VAPOR%RHO - 3.112086584570705D-11*T**4*VAPOR%RHO           &
                - 1.7531392341348808D0*VAPOR%RHO**2 + 0.016337040762004425D0*T*VAPOR%RHO**2 - 0.00005080207895538633D0*T**2*VAPOR%RHO**2          &
                + 5.2690873875885054D-8*T**3*VAPOR%RHO**2 - 1.6918721657663482D0*VAPOR%RHO**3 + 0.010352644150310147D0*T*VAPOR%RHO**3             &
                - 0.00001583783934071373D0*T**2*VAPOR%RHO**3 - 0.34622902695411484D0*VAPOR%RHO**4 + 0.001042069442089262D0*T*VAPOR%RHO**4         &
                - 0.007278966282372564D0*VAPOR%RHO**5
      ELSE IF((T.GE.332.D0).AND.(T.LE.347.D0)) THEN
        VAPOR%DRDT = 0.0027349989184879747D0 - 0.00003418171573287271D0*T + 1.5952183417150958D-7*T**2 - 3.296335553972185D-10*T**3     &
                + 2.545725331783D-13*T**4 - 0.21908046643019907D0*VAPOR%RHO + 0.0026310597719816555D0*T*VAPOR%RHO                            &
                - 0.000012103906318237557D0*T**2*VAPOR%RHO + 2.4840583043625168D-8*T**3*VAPOR%RHO - 1.9122677235546308D-11*T**4*VAPOR%RHO         &
                - 0.6965991472905452D0*VAPOR%RHO**2 + 0.0061551518242377095D0*T*VAPOR%RHO**2 - 0.00001817241916521105D0*T**2*VAPOR%RHO**2         &
                + 1.791163543979636D-8*T**3*VAPOR%RHO**2 - 0.32467128630581D0*VAPOR%RHO**3 + 0.0018957809746163372D0*T*VAPOR%RHO**3               &
                - 2.768681600604109D-6*T**2*VAPOR%RHO**3 - 0.03814270926478833D0*VAPOR%RHO**4 + 0.00011037670500046392D0*T*VAPOR%RHO**4           &
                - 0.0010845296436386492D0*VAPOR%RHO**5
      ELSE IF((T.GT.347.D0).AND.(T.LE.397.D0)) THEN
        VAPOR%DRDT = -0.0000491213869994715D0 + 4.3699109475449D-7*T - 1.27801403663623D-9*T**2 + 1.23702103316548D-12*T**3 -           &
                 0.00745673136638664D0*VAPOR%RHO + 0.0000155921168719041D0*T*VAPOR%RHO + 1.11675572608361D-10*T**2*VAPOR%RHO -                    &
                 2.03129818205504D-11*T**3*VAPOR%RHO - 0.0727116915503993D0*VAPOR%RHO**2 + 0.000559946132162153D0*T*VAPOR%RHO**2 -                &
                 1.45506600290402D-6*T**2*VAPOR%RHO**2 + 1.27101008348442D-9*T**3*VAPOR%RHO**2 - 0.0178975505425514D0*VAPOR%RHO**3 +              &
                 0.0000943938898436783D0*T*VAPOR%RHO**3 - 1.24666727989567D-7*T**2*VAPOR%RHO**3 - 0.00143272552687376D0*VAPOR%RHO**4 +            &
                 3.73822031270469D-6*T*VAPOR%RHO**4-0.0000272850579250176D0*VAPOR%RHO**5
      ELSE IF((T.GT.397.D0).AND.(T.LE.447.D0)) THEN
        VAPOR%DRDT = -0.0116146111379786D0 + 0.0000834812107294513D0*T - 1.99614022037687D-07*T**2 + 1.58811953545974D-10*T**3 +        &
                 0.0552686133839977D0*VAPOR%RHO - 0.000435201052381534D0*T*VAPOR%RHO + 1.07610493924041D-06*T**2*VAPOR%RHO -                      &
                 8.73145090591731D-10*T**3*VAPOR%RHO - 0.0709149440418435D0*VAPOR%RHO**2 + 0.000510724229940245D0*T*VAPOR%RHO**2-                 &
                 1.23091425806775D-06*T**2*VAPOR%RHO**2 + 9.90242686781605D-10*T**3*VAPOR%RHO**2 - 0.00643663811831822*VAPOR%RHO**3+              &
                 0.0000299908146192532D0*T*VAPOR%RHO**3 - 3.49445390054649D-08*T**2*VAPOR%RHO**3 - 0.000126284826162668D0*VAPOR%RHO**4+           &
                 2.88102955025302D-07*T*VAPOR%RHO**4 - 5.55731072635301D-07*VAPOR%RHO**5
      ELSE IF((T.GT.447.D0).AND.(T.LE.497.D0)) THEN
        VAPOR%DRDT = -0.0864611400507011D0 + 0.000564503319948696D0*T - 1.22681430912334D-06*T**2 + 8.87456451441192D-10*T**3 +         &
                 0.198845609823498D0*VAPOR%RHO - 0.00133530111502184D0*T*VAPOR%RHO + 2.94049042029591D-06*T**2*VAPOR%RHO -                        &
                 2.14699720902986D-09*T**3*VAPOR%RHO - 0.0745875895526571D0*VAPOR%RHO**2 + 0.000496395999451785D0*T*VAPOR%RHO**2 -                &
                 1.10225985771488D-06*T**2*VAPOR%RHO**2 + 8.15329494815788D-10*T**3*VAPOR%RHO**2 - 0.00272923523424554D0*VAPOR%RHO**3 +           &
                 0.0000116460569402577D0*T*VAPOR%RHO**3 - 1.24218143895751D-08*T**2*VAPOR%RHO**3 - 0.0000220275512608702D0*VAPOR%RHO**4 +         &
                 4.57228531090116D-08*T*VAPOR%RHO**4 - 3.62049533964305D-08*VAPOR%RHO**5
        
      ELSE !IF((T.GT.497.D0).AND.(T.LE.552.D0)) THEN
        VAPOR%DRDT = -0.00971360853462954D0 + 0.0000366376246703219D0*T - 3.4479458553232D-08*T**2 - 0.0000432642035811531D0*VAPOR%RHO -     &
                 0.000010274561150715D0*T*VAPOR%RHO + 1.2766404543913D-08*T**2*VAPOR%RHO - 0.000742479359962173D0*VAPOR%RHO**2 +                  &
                 0.0000019451020297395D0*T*VAPOR%RHO**2 - 1.22586476060632D-09*T**2*VAPOR%RHO**2 - 0.00029193963090101D0*VAPOR%RHO**3 +           &
                 1.09811167895505D-06*T*VAPOR%RHO**3 - 1.03935342359949D-09*T**2*VAPOR%RHO**3 - 1.61008564793834D-06*VAPOR%RHO**4 +               &
                 3.03605870434151D-09*T*VAPOR%RHO**4 - 1.81412095488845E-09*VAPOR%RHO**5
      END IF
    
      IF (T.LT.296.D0) THEN
        VAPOR%DHDP = -42948.92139971102D0 + 774.1474629248053D0*T - 5.574937750585217D0*T**2 +                                        &
                    0.020049561101358117D0*T**3 - 0.00003601017265315555D0*T**4 + 2.5840711650456145D-8*T**5 -                     &
                    3.8795311376638315D6*VAPOR%RHO + 53841.27611225954D0*T*VAPOR%RHO - 280.16500438649547D0*T**2*VAPOR%RHO +                      &
                    0.647830494592685D0*T**3*VAPOR%RHO - 0.0005616580339274063D0*T**4*VAPOR%RHO - 2.529432983615679D7*VAPOR%RHO**2+               &
                    257585.75930428825D0*T*VAPOR%RHO**2 - 874.587299851378D0*T**2*VAPOR%RHO**2 +                                             &
                    0.9900592360302818D0*T**3*VAPOR%RHO**2            
      ELSE IF((T.GE.296.D0).AND.(T.LT.314.D0)) THEN        
        VAPOR%DHDP = -15586.728701871567D0 + 264.0264835470356D0*T - 1.7875045343117237D0*T**2 +                                      &
                    0.006045307503336912D0*T**3 - 0.000010212748709652075D0*T**4 + 6.894542736674656D-9*T**5 -                     &
                    527744.9289123041D0*VAPOR%RHO + 6900.184295261724D0*T*VAPOR%RHO - 33.827285188196655D0*T**2*VAPOR%RHO +                       &
                    0.07369354996628959D0*T**3*VAPOR%RHO - 0.000060195142611365495D0*T**4*VAPOR%RHO -                                        &
                    1.2692441139548968D6*VAPOR%RHO**2 + 12179.77837626357D0*T*VAPOR%RHO**2 -                                                 &
                    38.9691482898955D0*T**2*VAPOR%RHO**2 + 0.04157034917642339D0*T**3*VAPOR%RHO**2
      ELSE IF((T.GE.314.D0).AND.(T.LT.332.D0)) THEN
        VAPOR%DHDP = -5985.323520493672D0 + 95.44189489466376D0*T - 0.6086603702954034D0*T**2 +                                       &
                    0.0019399724785255999D0*T**3 - 3.0898699024029392D-6*T**4 + 1.967274233030398D-9*T**5 -                        &
                    78428.828592011D0*VAPOR%RHO+970.2347151449338D0*T*VAPOR%RHO - 4.500508099945776D0*T**2*VAPOR%RHO +                            &
                    0.00927714313504291D0*T**3*VAPOR%RHO - 7.170466057187251D-6*T**4*VAPOR%RHO - 81033.69763174784D0*VAPOR%RHO**2 +               &
                    736.6191168105244D0*T*VAPOR%RHO**2 - 2.2326112086981085D0*T**2*VAPOR%RHO**2 +                                            &
                    0.0022561595659607156D0*T**3*VAPOR%RHO**2 - 1845.1443282315129D0*VAPOR%RHO**3 +                                          &
                    11.233381579730002D0*T*VAPOR%RHO**3 - 0.017101053012734537D0*T**2*VAPOR%RHO**3
      ELSE IF((T.GE.332.D0).AND.(T.LE.347.D0)) THEN
        VAPOR%DHDP = -2685.651624312814D0 + 40.408089706028505D0*T - 0.2433658728309133D0*T**2 +                                      &
                    0.0007330697580489127D0*T**3 - 1.1041140047375149D-6*T**4 + 6.650974354118622D-10*T**5 -                       &
                    13687.143431442617D0*VAPOR%RHO + 161.11583016560508D0*T*VAPOR%RHO - 0.7111991512467304D0*T**2*VAPOR%RHO +                     &
                    0.0013952479260520127D0*T**3*VAPOR%RHO-1.0264259793980518D-6*T**4*VAPOR%RHO-6823.122132832979D0*VAPOR%RHO**2+                 & 
                    59.14067793196761D0*T*VAPOR%RHO**2 - 0.17092804592023148D0*T**2*VAPOR%RHO**2 +                                           &
                    0.00016472384887903586D0*T**3*VAPOR%RHO**2 - 253.26035577631035D0*VAPOR%RHO**3 +                                         &
                    1.4874538670237314D0*T*VAPOR%RHO**3 - 0.002182372555770298D0*T**2*VAPOR%RHO**3 -                                         &
                    36.98478579604281D0*VAPOR%RHO**4 + 0.10488084893954559D0*T*VAPOR%RHO**4
      ELSE IF((T.GT.347.D0).AND.(T.LE.397.D0)) THEN
        VAPOR%DHDP = -13.7891645369465D0 + 0.101162496581722D0*T - 0.000251834570684114D0*T**2 + 2.11403618349564D-07*T**3 -          &
                   3.48932771355333D0*VAPOR%RHO + 0.0177668288455497D0*T*VAPOR%RHO - 0.0000226806539879019D0*T**2*VAPOR%RHO -                     &
                   0.213028973710571D0*VAPOR%RHO**2 + 0.000527329802151844D0*T*VAPOR%RHO**2
      ELSE IF((T.GT.397.D0).AND.(T.LE.447.D0)) THEN
        VAPOR%DHDP = -2.30175009407832D0 + 0.0120585839248053D0*T - 0.0000212164847528242D0*T**2 + 1.22563572857418D-08*T**3 -        &
                   6.12857017700577D0*VAPOR%RHO + 0.0433971794477965D0*T*VAPOR%RHO - 0.000102787728553932D0*T**2*VAPOR%RHO +                      &
                   8.13319224771949D-08*T**3*VAPOR%RHO - 0.556896790690874D0*VAPOR%RHO**2 + 0.00261694430608853D0*T*VAPOR%RHO**2 -                &
                   3.06968998459052D-06*T**2*VAPOR%RHO**2 - 0.0124048270971314D0*VAPOR%RHO**3 + 0.0000281589576227285D0*T*VAPOR%RHO**3 -          &
                   0.0000388702957448261*VAPOR%RHO**4
      ELSE IF((T.GT.447.D0).AND.(T.LE.497.D0)) THEN
        VAPOR%DHDP = -3.53105327478957D0 + 0.0205069948762115D0*T - 0.0000406757484955379D0*T**2 + 2.72722604602877D-08*T**3 +        &
                   2.37467611198915D0*VAPOR%RHO - 0.0156394857378528D0*T*VAPOR%RHO + 0.0000341112896898702D0*T**2*VAPOR%RHO -                     &
                   2.46756737993989D-08*T**3*VAPOR%RHO - 1.09371605112861D0*VAPOR%RHO**2 + 0.00709746784239992D0*T*VAPOR%RHO**2 -                 &
                   0.0000153269087339451D0*T**2*VAPOR%RHO**2 + 1.10142491313411D-08*T**3*VAPOR%RHO**2 - 0.0204302542017631D0*VAPOR%RHO**3 +       &
                   0.0000855009278132256D0*T*VAPOR%RHO**3 - 8.93387442246377D-08*T**2*VAPOR%RHO**3 - 0.0000765698781615174D0*VAPOR%RHO**4 +       &
                   1.54780324969024D-07*T*VAPOR%RHO**4-2.89819007617669D-08*VAPOR%RHO**5
        
      ELSE IF((T.GT.497.D0).AND.(T.LE.517.D0)) THEN
    
        VAPOR%DHDP = -4.97816126755044D0 + 0.028377508774646D0*T - 0.0000547211830793747D0*T**2 + 3.54570677399166D-08*T**3 +         &
                   2.86357345093025D0*VAPOR%RHO - 0.0174229907386162D0*T*VAPOR%RHO + 0.0000352485407932868D0*T**2*VAPOR%RHO -                     &
                   2.37258046341918D-08*T**3*VAPOR%RHO - 0.423789001925988D0*VAPOR%RHO**2 + 0.00259334071331075D0*T*VAPOR%RHO**2 -                &
                   5.28716718390658D-06*T**2*VAPOR%RHO**2 + 3.59102899347635D-09*T**3*VAPOR%RHO**2 - 0.00393075761935776D0*VAPOR%RHO**3 +         &
                   0.0000157503582818176D0*T*VAPOR%RHO**3 - 1.5771273186733D-08*T**2*VAPOR%RHO**3 - 0.0000109960071167684D0*VAPOR%RHO**4 +        &
                   2.16567800282055D-08*T*VAPOR%RHO**4 - 7.12630336161619D-09*VAPOR%RHO**5
        
      ELSE IF((T.GT.517.D0).AND.(T.LE.537.D0)) THEN
        VAPOR%DHDP = -4.22428894926394D0 + 0.0231923752936463D0*T - 0.0000430905939952741D0*T**2 + 2.69041685271792D-08*T**3 +        &
                   1.72798881908645D0*VAPOR%RHO - 0.0101426340594348D0*T*VAPOR%RHO + 0.0000197878211815207D0*T**2*VAPOR%RHO -                     &
                   1.2840856893509D-08*T**3*VAPOR%RHO - 0.184734743817539D0*VAPOR%RHO**2 + 0.00108817934315952D0*T*VAPOR%RHO**2 -                 &
                   2.13593136453837D-06*T**2*VAPOR%RHO**2 + 1.39692920624806D-09*T**3*VAPOR%RHO**2 - 0.00124849540237478D0*VAPOR%RHO**3 +         &
                   4.82126022692123D-06*T*VAPOR%RHO**3 - 4.65321504153324D-09 *T**2*VAPOR%RHO**3 - 2.61806209683763D-06*VAPOR%RHO**4 +            &
                   4.97932038812081D-09*T*VAPOR%RHO**4 - 1.37762262774754D-09*VAPOR%RHO**5
      ELSE !IF((T.GT.537.D0).AND.(T.LE.552.D0)) THEN
        VAPOR%DHDP = -0.276039525042864D0 + 0.000744183648679953D0*T - 5.31879113542593D-07*T**2 - 0.0878128596698185D0*VAPOR%RHO +        &
                   0.000310472439579764D0*T*VAPOR%RHO - 2.76518971688037D-07*T**2*VAPOR%RHO + 0.00793839664309268D0*VAPOR%RHO**2 -                &
                   0.0000298325227021426D0*T*VAPOR%RHO**2 + 2.79885337100082D-08*T**2*VAPOR%RHO**2 - 0.000424804774961827D0*VAPOR%RHO**3 +        &
                   1.59897629495813D-06*T*VAPOR%RHO**3 - 1.50456834308976D-09*T**2*VAPOR%RHO**3 - 8.57195694781748D-07*VAPOR%RHO**4 +             &
                   1.59041253984922D-09*T*VAPOR%RHO**4 - 4.2109909723164D-10 *VAPOR%RHO**5
        
      END IF
    END SUBROUTINE H2O_V_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE IAPWS97_L(EOS,P,T,LIQUID)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID
      REAL(8) :: PI,TAU,GT,GP,GPP,GTT,GPT
      REAL(8) :: G,G1,G2,G3,G4,G5,PI1,TAU1,GP1
      INTEGER :: K

      PI = P/16.53D6
      TAU = 1386D0/T
      
      PI1 = 1.D0/(7.1D0-PI)
      TAU1 = 1.D0/(TAU-1.222D0)
      GT = 0.D0
      GP = 0.D0
      GPP = 0.D0
      GTT = 0.D0
      GPT = 0.D0
      DO K = 1,34
        G = EOS%IAPWS_LIQUID_COEFF%N(K)*(7.1D0-PI)**EOS%IAPWS_LIQUID_COEFF%I(K)*(TAU-1.222D0)**EOS%IAPWS_LIQUID_COEFF%J(K)
        G1 = DBLE(EOS%IAPWS_LIQUID_COEFF%J(K))*G*TAU1
        G2 = - DBLE(EOS%IAPWS_LIQUID_COEFF%I(K))*G*PI1
        G3 = - DBLE(EOS%IAPWS_LIQUID_COEFF%I(K)-1)*G2*PI1
        G4 = DBLE(EOS%IAPWS_LIQUID_COEFF%J(K)-1)*G1*TAU1
        G5 = DBLE(EOS%IAPWS_LIQUID_COEFF%J(K))*G2*TAU1
        GT = GT + G1
        GP = GP + G2
        GPP = GPP + G3
        GTT = GTT + G4
        GPT = GPT + G5
      END DO      
      
      GP1 = 1.D0/GP
      
      LIQUID%RHO  = 25.841246054191803727*TAU*GP1
      LIQUID%H    = 639675.036D0*GT
      LIQUID%DRDP = -GPP*1.5632937721834122D-6*TAU*GP1**2
      LIQUID%DRDT = -LIQUID%RHO*7.215007215007215D-4*TAU + 0.01864447767257706*GPT*TAU**3*GP1**2
      LIQUID%DHDP = 0.03869782431941923775*GPT
      LIQUID%DHDT = -461.526D0*TAU**2*GTT
      
    END SUBROUTINE IAPWS97_L
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE IAPWS97_V(EOS,P,T,VAPOR)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
      REAL(8) :: PWW
      REAL(8) :: PI,TAU,G0T,G0P,G0PP,G0TT,G0PT,GRT,GRP,GRPP,GRTT,GRPT
      REAL(8) :: G0,G01,G02
      REAL(8) :: GR,GR1,GR2,GR3,GR4,GR5,PI1,TAU1,TAU2,GP1
      INTEGER :: K
      
      PWW = EOS%GET_PWW(T)
      
      PI = P/1D6
      TAU = 540D0/T
      
      PI1 = 1.D0/PI
      TAU1 = 1.D0/TAU
      TAU2 = 1.D0/(TAU-0.5D0)
      
      G0T = 0.D0
      G0P = PI1
      G0PP = -PI1**2
      G0TT = 0.D0
      G0PT = 0.D0
      GRT = 0.D0
      GRP = 0.D0
      GRPP = 0.D0
      GRTT = 0.D0
      GRPT = 0.D0
    
      IF(P.GT.PWW) THEN
        DO K = 1,13
          IF(K.LE.9) THEN
            G0 = EOS%IAPWS_M_VAPOR_COEFF%N(K)*TAU**EOS%IAPWS_M_VAPOR_COEFF%J(K)
            G01 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%J(K))*G0*TAU1
            G02 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%J(K)-1)*G01*TAU1
            G0T = G0T + G01
            G0TT = G0TT + G02
          END IF
          GR = EOS%IAPWS_M_VAPOR_COEFF%NR(K)*PI**EOS%IAPWS_M_VAPOR_COEFF%IR(K)*(TAU-0.5D0)**EOS%IAPWS_M_VAPOR_COEFF%JR(K)
          GR1 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%JR(K))*GR*TAU2
          GR2 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%IR(K))*GR*PI1
          GR3 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%IR(K)-1)*GR2*PI1
          GR4 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%JR(K)-1)*GR1*TAU2
          GR5 = DBLE(EOS%IAPWS_M_VAPOR_COEFF%JR(K))*GR2*TAU2
          GRT = GRT + GR1
          GRP = GRP + GR2
          GRPP = GRPP + GR3
          GRTT = GRTT + GR4
          GRPT = GRPT + GR5
        END DO
      ELSE
        DO K = 1,43
          IF(K.LE.9) THEN
            G0 = EOS%IAPWS_VAPOR_COEFF%N(K)*TAU**EOS%IAPWS_VAPOR_COEFF%J(K)
            G01 = DBLE(EOS%IAPWS_VAPOR_COEFF%J(K))*G0*TAU1
            G02 = DBLE(EOS%IAPWS_VAPOR_COEFF%J(K)-1)*G01*TAU1
            G0T = G0T + G01
            G0TT = G0TT + G02
          END IF
          GR = EOS%IAPWS_VAPOR_COEFF%NR(K)*PI**EOS%IAPWS_VAPOR_COEFF%IR(K)*(TAU-0.5D0)**EOS%IAPWS_VAPOR_COEFF%JR(K)
          GR1 = DBLE(EOS%IAPWS_VAPOR_COEFF%JR(K))*GR*TAU2
          GR2 = DBLE(EOS%IAPWS_VAPOR_COEFF%IR(K))*GR*PI1
          GR3 = DBLE(EOS%IAPWS_VAPOR_COEFF%IR(K)-1)*GR2*PI1
          GR4 = DBLE(EOS%IAPWS_VAPOR_COEFF%JR(K)-1)*GR1*TAU2
          GR5 = DBLE(EOS%IAPWS_VAPOR_COEFF%JR(K))*GR2*TAU2
          GRT = GRT + GR1
          GRP = GRP + GR2
          GRPP = GRPP + GR3
          GRTT = GRTT + GR4
          GRPT = GRPT + GR5
        END DO
      END IF
      
      GP1 = 1.D0/(G0P+GRP)
      
      VAPOR%RHO  = 4.01245401527075799D0*TAU*GP1
      VAPOR%H    = 249224.04D0*(G0T+GRT)
      VAPOR%DRDP = -(G0PP+GRPP)*4.01245401527075799D-6*TAU*GP1**2
      VAPOR%DRDT = -VAPOR%RHO*0.00185185185185185185*TAU + 0.0074304703986495518*(G0PT+GRPT)*TAU**3*GP1**2
      VAPOR%DHDP = 0.24922404D0*(G0PT+GRPT)
      VAPOR%DHDT = -461.526D0*TAU**2*(G0TT+GRTT)
      
    END SUBROUTINE IAPWS97_V
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE STIFFENED(EOS,P,T,LIQUID)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID
      REAL(8), PARAMETER :: R1 = 1.D0/2691.D0
      REAL(8) :: TAU
      
      TAU = 1.D0/T

      LIQUID%RHO  = (P+8.5D8)*R1*TAU
      LIQUID%H    = 4186.D0*T
      LIQUID%DRDP = R1*TAU
      LIQUID%DRDT = -(P+8.5D8)*R1*TAU**2
      LIQUID%DHDP = 0.D0
      LIQUID%DHDT = 4186.D0
      
    END SUBROUTINE STIFFENED
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE N2_L_FIT(EOS,P,T,LIQUID)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID
      
      LIQUID%RHO = 3278.7479320710095D0 -140.53866400032032D0*T + 3.4391996294042255D0*T**2 - 0.04313918674235664D0*T**3+                &
             0.0002701512499721705D0*T**4 - 6.808567943865866D-7*T**5 + 0.0001263733642858279D0*P -                                &
             6.922008184428884D-6*T*P +1.4177982228082052D-7*T**2*P - 1.27888626669828D-9*T**3*P +                                 &
             4.337249290759174D-12*T**4*P + 5.963833700360859D-12*P**2 -                                                           &
             2.288595626069022D-13*T*P**2 +2.9357774279657827D-15*T**2*P**2 -                                                      &
             1.2665399523355606D-17*T**3*P**2  
      
      IF(T.LT.75.D0) THEN
        LIQUID%DRDP = 0.00020259945009638386D0 - 8.557700251478422D-7*T + 9.866811451399918D-10*T**2 -                                   &
                    3.8236563833158784D-7*LIQUID%RHO + 8.16705219276515D-10*T*LIQUID%RHO + 1.809590831406454D-10*LIQUID%RHO**2
        LIQUID%DRDT = -247.86002574696704 + 1.461427245574839*T - 0.002193220588925308*T**2 + 0.4220428895914477*LIQUID%RHO -                  &
                    0.0012658720516194725*T*LIQUID%RHO - 0.00018145431872668984*LIQUID%RHO**2
      ELSE IF((T.GE.75.D0).AND.(T.LT.85.D0)) THEN
        LIQUID%DRDP = 0.0003107714792534878D0-1.4580031144969927D-6*T+1.878326893643818D-9*T**2 -                                        &
                    5.913408276569343D-7*LIQUID%RHO + 1.3886778703445793D-9*T*LIQUID%RHO + 2.823329207920792D-10*LIQUID%RHO**2
        LIQUID%DRDT = -297.385479939352D0 + 1.7627825395290624D0*T - 0.00264790794680055D0*T**2 +                                        &
                    0.5153374297778337D0*LIQUID%RHO -0.0015504587543153292D0*T*LIQUID%RHO - 0.0002253532129203019D0*LIQUID%RHO**2
      ELSE IF((T.GE.85.D0).AND.(T.LT.95.D0)) THEN
        LIQUID%DRDP = 0.0005381464209109027D0-2.844760393759367D-6*T + 4.078531373621749D-9*T**2 -                                       &
                    1.027004966405762D-6*LIQUID%RHO + 2.6986099993842745D-9*T*LIQUID%RHO + 4.920323909333415D-10*LIQUID%RHO**2
        LIQUID%DRDT = -407.9014901431543D0 + 2.5256977364739486D0*T - 0.0039453749684370005D0*T**2 +                                     &
                    0.7170907625038794D0*LIQUID%RHO - 0.002251246844406133D0*T*LIQUID%RHO - 0.0003171779048991788D0*LIQUID%RHO**2
      ELSE
        LIQUID%DRDP = 0.0011931950341395573D0 - 7.632317529105058D-6*T + 1.3195922863204093D-8*T**2 -                                    &
                    2.2091813560313297D-6*LIQUID%RHO + 6.920022440956056D-9*T*LIQUID%RHO + 1.0319826829467008D-9*LIQUID%RHO**2
        LIQUID%DRDT = -664.661596560617D0 + 4.5231316387311296D0*T - 0.00775764679239673D0*T**2 +                                        &
                    1.164397373989908D0*LIQUID%RHO - 0.004010605364921429D0*T*LIQUID%RHO - 0.0005106823684308862D0*LIQUID%RHO**2
      END IF

    END SUBROUTINE N2_L_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE N2_V_FIT(EOS,P,T,VAPOR)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
      
      IF(T.LT.75.D0) THEN
        VAPOR%RHO  = 0.5166D0 - 0.02249D0*T + 0.0001501D0*P + 0.000325D0*T**2 - 0.000002214D0*T*P +                                     &
                0.0000000001156D0*P**2 - 0.000001559D0*T**3 + 0.00000001081D0*T**2*P -                                             &
                0.000000000001246D0*T*P**2
        VAPOR%DRDP = 0.0002002D0 - 0.000004451D0*T + 0.00001142D0*VAPOR%RHO + 0.0000000439D0*T**2 - 0.0000002484D0*T*VAPOR%RHO                    &
                + 0.0000001744D0*VAPOR%RHO**2 - 0.0000000001621D0*T**3 + 0.000000001439D0*T**2*VAPOR%RHO                                     &
                - 0.000000002071D0*T*VAPOR%RHO**2 + 0.0000000005365D0*VAPOR%RHO**3
        VAPOR%DRDT = 0.001042D0 - 0.00002954D0*T - 0.04749D0*VAPOR%RHO + 0.000000209D0*T**2 + 0.0007431D0*T*VAPOR%RHO-                            &
                0.002029D0*VAPOR%RHO**2 - 0.000003837D0*T**2*VAPOR%RHO + 0.00002203D0*T*VAPOR%RHO**2 - 0.00001267D0*VAPOR%RHO**3          
      ELSE IF((T.GE.75.D0).AND.(T.LT.85.D0)) THEN
        VAPOR%RHO  = - 0.3101D0+0.00782D0*T+0.0001439D0*P - 0.00004921D0*T**2 - 0.000002023D0*T*P +                                     &
                0.00000000008892D0*P**2  + 0.000000009375D0*T**2*P - 0.0000000000009134D0*T*P**2 +                                 &
                1.234D-17*P**3
        VAPOR%DRDP = 0.0001269D0 - 0.000001592D0*T + 0.000007968D0*VAPOR%RHO + 0.00000000665D0*T**2 - 0.000000154D0*T*VAPOR%RHO +                 &
                0.00000009901D0*VAPOR%RHO**2 + 0.0000000007947D0*T**2*VAPOR%RHO - 0.000000001059D0*T*VAPOR%RHO**2 +                               &
                0.000000000257D0*VAPOR%RHO**3
        VAPOR%DRDT = - 0.01857D0 + 0.0008489D0*T - 0.0497D0*VAPOR%RHO - 0.00001259D0*T**2 + 0.0007831D0*T*VAPOR%RHO - 0.001607D0*VAPOR%RHO**2          &
                + 0.00000006098D0*T**3 - 0.000003973D0*T**2*VAPOR%RHO + 0.00001609D0*T*VAPOR%RHO**2 - 0.000007701D0*VAPOR%RHO**3
      ELSE IF((T.GE.85.D0).AND.(T.LT.95.D0)) THEN
        VAPOR%RHO  = - 2.669D0 + 0.06128D0*T + 0.0001518D0*P - 0.0003514D0*T**2 - 0.00000217D0*T*P +                                    &
                0.00000000007329D0*P**2 + 0.000000009994D0*T**2*P - 0.0000000000007113D0*T*P**2 +                                  &
                7.852D-18*P**3
        VAPOR%DRDT = - 0.003125D0 + 0.0000724D0*T - 0.02908D0*VAPOR%RHO - 0.0000004186D0*T**2 + 0.0002712D0*T*VAPOR%RHO -                         &
                0.00351D0*VAPOR%RHO**2 - 0.0000007957D0*T**2*VAPOR%RHO + 0.00006725D0*T*VAPOR%RHO**2 - 0.0000391D0*VAPOR%RHO**3 -                      &
                0.0000003415D0*T**2*VAPOR%RHO**2 + 0.0000003997D0*T*VAPOR%RHO**3 - 0.00000009137D0*VAPOR%RHO**4
        VAPOR%DRDP = 0.000134D0 - 0.000001751D0*T + 0.000002705D0*VAPOR%RHO + 0.000000007533D0*T**2 -                                        &
                0.00000002436D0*T*VAPOR%RHO + 0.000000009563D0*VAPOR%RHO**2
      ELSE 
        VAPOR%RHO  = 1.034D0 - 0.07884D0*T + 0.0001568D0*P + 0.001336D0*T**2 - 0.000002235D0*T*P +                                      &
                0.0000000000651D0*P**2 - 0.000006516D0*T**3 + 0.00000001007D0*T**2*P -                                             &
                0.0000000000006035D0*T*P**2 + 5.537D-18*P**3
        VAPOR%DRDT = - 0.001017D0 + 0.00001877D0*T - 0.03033D0*VAPOR%RHO - 0.00000008603D0*T**2 + 0.0003087D0*T*VAPOR%RHO -                       &
                0.001221D0*VAPOR%RHO**2 - 0.000001054D0*T**2*VAPOR%RHO + 0.00001559D0*T*VAPOR%RHO**2 - 0.00009703D0*VAPOR%RHO**3 -                     &
                0.00000005037D0*T**2*VAPOR%RHO**2 + 0.000001885D0*T*VAPOR%RHO**3 - 0.0000005862D0*VAPOR%RHO**4 -                                  &
                0.000000009349D0*T**2*VAPOR%RHO**3 + 0.00000000576D0*T*VAPOR%RHO**4 - 0.000000000703D0*VAPOR%RHO**5 
        VAPOR%DRDP = 0.0001016D0 - 0.000001022D0*T + 0.000003396D0*VAPOR%RHO + 0.000000003427D0*T**2 - 0.00000004841D0*T*VAPOR%RHO +              &
                0.0000001622D0*VAPOR%RHO**2 + 0.0000000001831D0*T**2*VAPOR%RHO - 0.000000003039D0*T*VAPOR%RHO**2 +                                &
                0.0000000009155D0*VAPOR%RHO**3 +  0.00000000001459D0*T**2*VAPOR%RHO**2 - 0.000000000008902D0*T*VAPOR%RHO**3 +                     &
                0.000000000001154D0*VAPOR%RHO**4
      END IF

    END SUBROUTINE N2_V_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE O2_L_FIT(EOS,P,T,LIQUID)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID

      
      
      LIQUID = T_EOS2(0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0)
    END SUBROUTINE O2_L_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE O2_V_FIT(EOS,P,T,VAPOR)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
     
      IF(T.LT.70.D0) THEN
        VAPOR%RHO = 0.09839D0 - 0.002916D0*T + 0.0001142D0*P + 0.00002159D0*T**2 - 0.0000008471D0*T*P + 0.0000000000452D0*P**2
      ELSE IF((T.GE.70.D0).AND.(T.LT.85.D0)) THEN
        VAPOR%RHO = - 0.0004756D0 + 0.00001172D0*T + 0.000152D0*P - 0.00000007195D0*T**2 - 0.000001994D0*T*P                        &
               + 0.0000000001147D0*P**2 + 0.000000008694D0*T**2*P - 0.000000000001166D0*T*P**2                                 &
               + 2.484D-17*P**3
      ELSE IF((T.GE.85.D0).AND.(T.LT.100.D0)) THEN
        VAPOR%RHO = - 0.02582D0 + 0.0005927D0*T + 0.00013D0*P - 0.000003392D0*T**2 - 0.000001467D0*T*P                              &
               + 0.00000000008644D0*P**2+ 0.000000005532D0*T**2*P - 0.000000000000824D0*T*P**2 + 1.541D-17*P**3
      ELSE
        VAPOR%RHO = 0.009632253324945106D0 - 0.00017573530285693376D0*T + 8.168869369962596D-7*T**2                                 &
               + 0.00010777377953337692D0*P - 1.004547904883942D-6*T*P                                                         &
               + 3.1157965295030853D-9*T**2*P + 2.9499227174247904D-11*P**2                                                    &
               - 2.1138410719274732D-13*T*P**2 + 1.5327208040241761D-18*P**3 
      END IF
      
    END SUBROUTINE O2_V_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE H2_L_FIT(EOS,P,T,LIQUID)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: LIQUID
      LIQUID = T_EOS2(0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0)
    END SUBROUTINE H2_L_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE H2_V_FIT(EOS,P,T,VAPOR)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: VAPOR
      VAPOR = T_EOS2(0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0)
    END SUBROUTINE H2_V_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    SUBROUTINE HE_V_FIT(EOS,P,T,GAS)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: P,T
      TYPE(T_EOS2), INTENT(OUT) :: GAS
      GAS = T_EOS2(0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0, 0.D0)
    END SUBROUTINE HE_V_FIT
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC    
    FUNCTION H2O_PWW(EOS,T) RESULT(PWW)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: PWW
      REAL(8) :: TT,THETA,A,B,C
      
      TT = DMIN1(DMAX1(T,273.15D0),647.096D0)
      THETA = TT - 0.23855557567849D0/(TT - 0.65017534844798D3)
      A = THETA**2 + 0.11670521452767D4*THETA - 0.72421316703206D6
      B = - 0.17073846940092D2*THETA**2 + 0.12020824702470D5*THETA - 0.32325550322333D7
      C = 0.14915108613530D2*THETA**2 - 0.48232657361591D4*THETA + 0.40511340542057D6
      PWW = 1.D6*(2.D0*C/(-B+DSQRT(B**2-4.D0*A*C)))**4
    END FUNCTION H2O_PWW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION N2_PWW(EOS,T) RESULT(PWW)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: PWW
      PWW = 0.D0
    END FUNCTION N2_PWW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION O2_PWW(EOS,T) RESULT(PWW)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: PWW
      PWW = 0.D0
    END FUNCTION O2_PWW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION H2_PWW(EOS,T) RESULT(PWW)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: PWW
      PWW = 0.D0
    END FUNCTION H2_PWW
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION H2O_SIGMA(EOS,T) RESULT(SIGMA)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: SIGMA
      
      SIGMA = 0.0881130429998226D0 + 0.0000616475914044782D0*T - 4.4860167748009D-7*T**2      &
            + 2.53682468718936D-10*T**3 - 2.62005668908913D-13*T**4 + 2.97878955533757D-16*T**5
            
    END FUNCTION H2O_SIGMA
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION N2_SIGMA(EOS,T) RESULT(SIGMA)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: SIGMA
      
      SIGMA = 0.0277139593881926D0 - 0.0001871381651395D0*T - 2.47277506113986D-6*T**2        &
            + 3.73212791877442D-8*T**3 - 2.44521143856208D-10*T**4 + 6.90956437271856D-13*T**5
                
    END FUNCTION N2_SIGMA
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION O2_SIGMA(EOS,T) RESULT(SIGMA)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: SIGMA
      
      SIGMA = 0.0383957397934739D0 - 0.000292004596094666D0*T - 1.63784793251168D-7*T**2      &
            + 5.57366451318535D-9*T**3 - 3.42769625844841D-11*T**4 + 1.05411729447465D-13*T**5
            
    END FUNCTION O2_SIGMA
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION H2_SIGMA(EOS,T) RESULT(SIGMA)
      IMPLICIT NONE
      CLASS(T_EOS), INTENT(IN) :: EOS
      REAL(8), INTENT(IN) :: T
      REAL(8) :: SIGMA
      
      SIGMA = 0.00520006147168522D0 - 0.000129664670257188D0*T -  4.14551445475162D-6*T**2    &
            + 2.18364493308481D-7*T**3 -  5.43761039654375D-9*T**4 + 5.62476539114984D-11*T**5
                            
    END FUNCTION H2_SIGMA
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION CUBICSOLVER(PIN,TIN,AALPHA,BIN,MW)
      IMPLICIT NONE
      REAL(8), INTENT(IN)  :: PIN,TIN,AALPHA,BIN,MW
      REAL(8) :: CUBICSOLVER
      REAL(8) :: P,Q,R
      REAL(8) :: A,B,D,M,N
      REAL(8) :: PHI,K,PI
      REAL(8),PARAMETER :: RU=8.314D0
      PI = DATAN(1.D0)*4.D0
      
      P = (BIN**2*PIN*MW - AALPHA*MW + RU*TIN*BIN*MW)/(AALPHA*BIN)
      Q = MW**2*RU*TIN/(AALPHA*BIN)
      R = -MW**3*PIN/(AALPHA*BIN)

      A = (3.D0*Q - P**2)/3.D0
      B = (2.D0*P**3 - 9.D0*P*Q + 27.D0*R)/27.D0
      D = A**3/27.D0 + B**2/4.D0
      
      M = (-0.5D0*B+DSQRT(D))**(1.D0/3.D0)
      N = (-0.5D0*B-DSQRT(D))**(1.D0/3.D0)
      
      IF (D.GT.0.D0) THEN
        CUBICSOLVER = M+N-P/3.D0  
      ELSE IF(D.EQ.0.D0) THEN
        IF((M+N - P/3.D0).GE.0.D0) THEN
          CUBICSOLVER = M+N - P/3.D0
        ELSE
          CUBICSOLVER = -0.5D0*(M+N) - P/3.D0
        END IF
      ELSE IF (D.LT.0.D0) THEN
        K = 0.D0
        IF (B.GT.0.D0) THEN
          PHI = DACOS(-DSQRT(-27.D0*B**2/(4.D0*A**3)))
        ELSE    
          PHI = DACOS(DSQRT(-27.D0*B**2/(4.D0*A**3)))
        END IF
        CUBICSOLVER = 2.D0*DSQRT(-A/3.D0)*DCOS((PHI+120.D0*K)*PI/180.D0) - P/3.D0   
      END IF
      
    END FUNCTION CUBICSOLVER
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    FUNCTION COMPUTEPV(TC,PC,TB,T)
      IMPLICIT NONE
      REAL(8), INTENT(IN) :: TC,PC,TB,T
      REAL(8) :: COMPUTEPV

      ! USING REIDEL'S FORMULA
      
      REAL(8) :: A,B,C,D
      REAL(8) :: TR,TBR,PBR
      REAL(8) :: K1,K2,PSI,Q,ALPHAC,TT
      
      K1 = 0.0838D0
      K2 = 3.758D0
      
      TT=DMIN1(TC-2.D0,T)
      
      TR  = TT/TC  
      TBR = TB/TC
      PBR = 101325.D0/PC
      
      PSI = -35.D0 + 36.D0/TBR + 42.D0*DLOG(TBR) - TBR**6
      ALPHAC = (K1*K2*PSI-DLOG(PBR))/(K1*PSI-DLOG(TBR))
      Q = K1*(K2-ALPHAC)
      
      A = -35.D0*Q
      B = -36.D0*Q
      C = 42.D0*Q + ALPHAC
      D = -Q
      COMPUTEPV = PC*DEXP(A - B/TR + C*DLOG(TR) + D*TR**6)
      
    END FUNCTION COMPUTEPV
    !CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
END MODULE EOS_MODULE